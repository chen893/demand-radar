# Demand Radar - 产品需求文档 (PRD) v2.0

> 版本: 2.0 (重大修订)
> 更新日期: 2025-12-09
> 产品负责人: [待定]
> 文档状态: 基于评审建议重构版

---

## 修订说明 (v2.0)

### 核心变更
1. **产品定位重构**: 从"需求信号收集器"转向"解决方案提炼器"
2. **数据模型革新**: 替换"痛点评分"为"解决方案 + 验证依据"结构
3. **平台优先级调整**: Reddit 提升为 MVP P0，与知乎并列
4. **LLM配置简化**: 支持多服务商，降低使用门槛
5. **需求聚合机制**: 新增用户主动触发的"重复需求分析"功能

### 评审问题解决状态
| 问题类别 | 关键问题 | 解决方案 | 状态 |
|---------|---------|---------|------|
| 战略层 | 价值主张模糊 | 重新定位为"解决方案提炼器" | ✅ 已解决 |
| 战略层 | 用户-平台错配 | Reddit 提升为 MVP P0 | ✅ 已解决 |
| 执行层 | 首次使用门槛高 | 多服务商LLM配置 + 离线摘要模式 | ✅ 已解决 |
| 架构层 | 数据模型不合理 | solution + validation 双层结构 | ✅ 已解决 |
| 架构层 | 需求聚合缺失 | 用户主动触发去重分析 | ✅ 已解决 |

---

## 一、产品概述

### 1.1 产品定位

**Demand Radar（需求雷达）** 是一款浏览器插件，帮助用户在日常浏览网页时自动捕捉用户吐槽与痛点，并利用 LLM 智能提炼出**可执行的产品方向**和**核心差异点**。

**一句话描述**：把每一次浏览，变成发现产品机会的雷达扫描。

**核心价值主张**：
- **输入**: 散落在 Reddit、知乎等平台的真实用户吐槽
- **输出**: 明确的产品方向 + 核心差异点 + 竞品不足 + 原文证据
- **人的角色**: 审核判断是否值得做，LLM 负责提炼方向

### 1.2 产品背景

**问题洞察**：
- 产品经理、创业者每天浏览大量网页，其中蕴含丰富的需求信号
- 这些信号散落在评论区、论坛帖子中，用户常是隐性表达（"XX 太难用了"而非"我愿付 $50"）
- **传统方案局限**: ChatGPT 虽能分析，但对话会丢失，无法结构化积累，来源不可追溯

**解决方案**：
- 通过浏览器插件无缝融入用户日常工作流
- 利用 LLM **提炼解决方案方向**（而非主观打分）
- 本地优先存储，构建个人解决方案知识库
- **来源可追溯**: 保存原文 URL + 证据摘录，方便后续验证

### 1.3 与 ChatGPT 的差异化

| 差异点 | Demand Radar | ChatGPT |
|-------|-------------|---------|
| **无缝嵌入工作流** | 浏览器原生 Side Panel，无需切换上下文 | 需要复制粘贴 + 切换应用 |
| **结构化积累** | Demand 实体 + 标签 + 时间线，永久保存 | 对话会丢失，难以回溯 |
| **来源可追溯** | 保存原文 URL + 证据摘录 | 无法追溯原始讨论 |
| **聚焦垂直场景** | 专注"从吐槽到产品方向" | 通用对话，需手动结构化 |

**协作策略**：
- 承认 ChatGPT 的强大，不做正面竞争
- 增加「一键在 ChatGPT 深入分析」按钮，做互补而非竞争

### 1.4 产品愿景

成为专业人士发现市场机会的第一入口，让每个人都拥有"从吐槽中嗅到产品机会"超能力。

---

## 二、目标用户

### 2.1 核心用户画像

| 用户类型 | 特征描述 | 核心诉求 | 使用频率 |
|---------|---------|---------|---------|
| **独立开发者** | 寻找 Side Project 方向，关注 Indie Hackers/Reddit | 发现可执行的产品创意 | 高频 |
| **产品经理** | 负责竞品分析和用户研究 | 高效捕捉用户痛点，提炼产品方向 | 高频 |
| **创业者** | 寻找创业方向或验证想法 | 系统化的机会发现 | 中频 |
| **投资人/分析师** | 研究行业趋势和投资标的 | 比市场更早发现信号 | 中频 |

### 2.2 用户优先级

**P0 (MVP 核心用户)**: 独立开发者、产品经理
**P1 (扩展用户)**: 创业者、内容创作者
**P2 (未来用户)**: 投资人、企业战略部门

**平台-用户匹配**：
- **Reddit + 独立开发者**: 全球用户吐槽集中，需求信号密度高
- **知乎 + 产品经理**: 中国市场洞察，用户表达更详细
- 两平台并行，覆盖全球 + 中国市场

---

## 三、用户场景

### 3.1 MVP 核心场景

#### 场景 1：Reddit 痛点挖掘 (MVP P0 必保)

> **用户**: 独立开发者小李
> **场景**: 浏览 r/SaaS 时看到一个吐槽帖
> **行为**: 点击插件提取帖子内容及评论
> **结果**: LLM 分析提炼出 2-3 个潜在产品方向，标注核心差异点和竞品不足
> **价值**: 小李将其中一个方向加入方案库，2 周后发现类似需求出现多次，决定深入调研

#### 场景 2：知乎问答分析 (MVP P0 必保)

> **用户**: 产品经理小王
> **场景**: 浏览知乎某个行业问题下的高赞回答
> **行为**: 点击插件提取问题和多个回答内容
> **结果**: LLM 识别出用户反复提及的痛点，提炼成解决方案方向
> **价值**: 发现目标用户群体的真实诉求，为产品规划提供依据

### 3.2 P1 扩展场景

#### 场景 3：跨设备需求回顾 (P1)

> **用户**: 创业者老张
> **场景**: 白天用公司电脑浏览，晚上用个人电脑复盘
> **行为**: 打开插件的"方案库"面板
> **结果**: 所有捕捉的方案通过云端同步，可按时间/来源/热度筛选
> **价值**: 系统化积累 2 个月后，发现一个反复出现的需求模式

#### 场景 4：方案去重分析 (P1)

> **用户**: 产品经理小王
> **场景**: 积累 20+ 个方案后
> **行为**: 点击"分析重复需求"按钮
> **结果**: LLM 批量分析整个方案库，发现 3 组相似需求，建议合并
> **价值**: 避免重复调研，更清晰地看到市场空白

### 3.3 平台适配器表

| 平台 | 优先级 | 解析方案 | 分页/懒加载处理 | 回退策略 |
|-----|-------|---------|---------------|---------|
| **Reddit** | P0 MVP必保 | 专用选择器提取帖子+评论树 | 用户手动展开/滚动后，一次性提取当前已加载内容 | Readability 纯正文提取 |
| **知乎** | P0 MVP必保 | 专用选择器提取问答内容 | 仅提取用户已展开内容（提示点击"查看全部"） | Readability 纯正文提取 |
| **Hacker News** | P1 | 评论树结构化提取 | 解析页面现有评论树，不监听懒加载 | 纯文本提取 |
| **通用网页** | P0 按需启用 | @mozilla/readability | 不处理 | 返回 document.body.innerText |

> **说明**: MVP 默认仅在用户明确授权的站点启用；安装引导推荐勾选 Reddit 或知乎；通用网页需用户授予域名权限后再注入。分页/懒加载不监听、不自动触发 LLM，点击"分析"时一次性抓取当前已加载/已展开内容。

---

## 四、功能需求

### 4.1 功能架构

```
┌─────────────────────────────────────────────────────────┐
│                    Demand Radar                          │
├─────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │  内容提取层  │  │  智能提炼层  │  │  数据管理层  │     │
│  ├─────────────┤  ├─────────────┤  ├─────────────┤     │
│  │ • 页面文本   │  │ • 方案提炼   │  │ • IndexedDB │
│  │ • 评论抓取   │  │ • 差异点     │  │ • 标签管理   │
│  │ • 元数据     │  │ • 竞品分析   │  │ • 搜索过滤   │
│  │ • 正文提取   │  │ • 离线降级   │  │ • 去重分析   │
│  └─────────────┘  └─────────────┘  └─────────────┘     │
├─────────────────────────────────────────────────────────┤
│                      用户界面层                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │ Side Panel  │  │  设置页面    │  │ 去重分析    │     │
│  │  (侧边栏)   │  │             │  │             │     │
│  └─────────────┘  └─────────────┘  └─────────────┘     │
└─────────────────────────────────────────────────────────┘
```

### 4.2 功能清单

#### P0 - MVP 必备功能

| 功能模块 | 功能点 | 描述 | 验收标准 |
|---------|-------|------|---------|
| **内容提取** | 一键提取 | 点击插件提取当前页面核心内容 | 见 [6.1 分场景性能指标] |
| | 智能正文识别 | 自动识别文章/帖子正文，过滤噪音 | 测试集：Reddit≥30个页面、知乎≥30个页面；准确率≥90%，召回率≥85% |
| | 评论提取 | 提取页面评论/回复内容 | 测试集：每站点≥30个帖子；结构化提取成功率≥85%，回退到纯文本时有明确提示 |
| **智能提炼** | 方案提炼 | LLM 分析内容，提炼产品方向 + 核心差异点 | 人工标注50条样本对照，方案合理性≥3.5/5分 |
| | 竞品分析 | 识别相关竞品及不足 | 竞品不足覆盖率≥80%（基于原文证据） |
| | 证据提取 | 保存痛点原文证据 | 每条方案包含≥2个原文证据摘录 |
| | 离线降级 | LLM 不可用时的降级处理 | 存储原文+基础摘要，标记"待分析" |
| **数据管理** | 本地存储 | IndexedDB 持久化存储 | 支持离线访问，单条记录≤500KB，超限自动截断并提示 |
| | 方案列表 | 查看所有提炼的方案 | 支持时间排序、标签筛选 |
| | 基础搜索 | 关键词搜索方案库 | 响应时间 < 500ms (1000条记录内) |
| | 去重分析 | 用户主动触发批量去重 | LLM 批量分析，返回分组建议，用户可合并/忽略 |
| **用户界面** | Side Panel | 侧边栏展示提炼结果、方案列表和快捷操作 | 首次打开 < 500ms，清晰展示方案卡片 |
| | 设置页面 | 多服务商LLM配置、站点白/黑名单 | 配置项持久化保存，支持 OpenAI/Google/DeepSeek/自定义 |
| **LLM配置** | 多服务商支持 | OpenAI/Google/DeepSeek/自定义 API | 预设常用配置，支持自定义 Base URL |
| | 离线摘要模式 | 无需API Key的基础摘要 | 使用 Readability 生成摘要，降低使用门槛 |

**MVP 数据策略说明**：
- MVP 阶段采用 **纯本地 IndexedDB** 方案
- IndexedDB 存储完整数据（原文、提炼结果、用户标注）
- 不包含云端服务器、账户系统、跨设备同步功能（移至 P1）

#### P1 - 增强功能

| 功能模块 | 功能点 | 描述 | 备注 |
|---------|-------|------|------|
| **云端同步** | 账户系统 | 邮箱注册/登录 | 见 [附录E P1同步方案] |
| | 跨设备同步 | 方案数据实时同步 | 见 [附录E P1同步方案] |
| | 数据导出 | 导出为 JSON/CSV/Markdown | |
| **高级分析** | 趋势追踪 | 追踪需求热度变化 | |
| | 批量分析 | 一次分析多个页面/评论 | 不纳入MVP测评 |
| **平台扩展** | Twitter/X 适配 | 受限支持公开内容提取 | 受平台限制 |
| **个性化** | 自定义标签 | 用户自定义标签体系 | |
| | 分析偏好 | 设置关注的行业/领域 | |
| | 快捷键 | 自定义快捷键触发 | |

#### P2 - 远期功能

| 功能点 | 描述 |
|-------|------|
| 方案社区 | 匿名分享/订阅他人发现的方案 |
| 竞品关联 | 自动关联相关竞品信息 |
| 时间旅行 | 查看方案的历史演变 |
| AI 副驾驶 | 直接生成 PRD/用户故事 |
| 团队协作 | 团队共享方案库 |

### 4.3 MVP 数据模型

**设计原则**：采用两层数据结构，以**单个方案为最小管理单元**，同时保留提取上下文。

```
┌─────────────────────────────────────────────────────┐
│                    数据关系                          │
├─────────────────────────────────────────────────────┤
│   Extraction（提取记录）         Solution（方案）    │
│   ┌─────────────────┐          ┌─────────────────┐  │
│   │ 来源页面信息     │    ┌────▶│ 独立方案实体    │  │
│   │ 原文 + 摘要     │    │     │ 可单独管理      │  │
│   │ 分析状态        │────┤     │ 标签/收藏/笔记  │  │
│   └─────────────────┘    │     └─────────────────┘  │
│                          │     ┌─────────────────┐  │
│                          └────▶│ ...更多方案     │  │
│                                └─────────────────┘  │
│                 1 : N 关系                          │
└─────────────────────────────────────────────────────┘
```

**核心变革**：
- **旧模型**: painLevel (8/10) + frequency (6/10) + payWillingness (7/10)
- **新模型**: solution { title, description, targetUser, keyDifferentiators } + validation { painPoints, competitors, competitorGaps, quotes }

```typescript
/**
 * MVP 数据模型 v2.0 - 两层结构
 * 存储位置: IndexedDB (Dexie.js)
 *
 * 【重要】本地存储保留原文，不进行 PII 脱敏
 * PII 过滤仅在发送给 LLM 之前执行
 */

/**
 * 提取记录 - 记录一次页面分析的上下文
 */
interface Extraction {
  id: string;                    // UUID
  url: string;                   // 来源页面 URL
  title: string;                 // 页面标题
  platform: string;              // 平台标识 (reddit/zhihu/generic)
  originalText: string;          // 原始文本（原文，未脱敏）
  summary: string;               // AI 生成的页面摘要
  analysisStatus: 'completed' | 'pending' | 'failed';  // 分析状态
  solutionCount: number;         // 识别出的方案数量
  savedSolutionCount: number;    // 用户保存的方案数量
  truncated: boolean;            // 是否因超过 500KB 被截断
  capturedAt: Date;              // 捕获时间
  createdAt: Date;
  updatedAt: Date;
}

/**
 * 方案 - 核心实体，最小管理单元 (v2.0 重大重构)
 */
interface Solution {
  id: string;                    // UUID
  extractionId: string;          // 关联的提取记录 ID

  // ===== 核心：解决方案 =====
  solution: {
    title: string;               // 产品名/一句话描述
    description: string;         // 详细描述（2-3句）
    targetUser: string;          // 目标用户
    keyDifferentiators: string[]; // 核心差异点（3-5个）
  };

  // ===== 支撑：验证依据 =====
  validation: {
    painPoints: string[];        // 用户痛点（原文摘录）
    competitors: string[];       // 竞品名称
    competitorGaps: string[];    // 竞品不足
    quotes: string[];            // 原文证据（3-5个关键摘录）
  };

  // ===== 来源快照 (冗余存储，便于列表展示) =====
  sourceUrl: string;             // 来源 URL
  sourceTitle: string;           // 来源标题
  sourcePlatform: string;        // 来源平台

  // ===== 用户管理字段 =====
  tags: string[];                // 用户标签
  starred: boolean;              // 是否收藏
  archived: boolean;             // 是否归档
  notes: string;                 // 用户笔记

  // ===== 方案分组（用户确认后填充） =====
  groupId?: string;              // 同一方案的分组 ID
  groupName?: string;            // 分组名称（如「PDF 工具需求」）

  createdAt: Date;
  updatedAt: Date;
}

/**
 * 去重分析结果 (P1 功能)
 */
interface DuplicateAnalysisResult {
  groups: Array<{
    suggestedName: string;       // LLM 建议的分组名
    solutionIds: string[];       // 属于这一组的方案 ID
    reason: string;              // 为什么认为是同一方案
  }>;
  uniqueSolutions: string[];     // 没有重复的方案 ID
}
```

**存储策略**：

| 数据 | 存储位置 | 说明 |
|-----|---------|------|
| Extraction | IndexedDB | 完整提取记录，支持离线，单条≤500KB |
| Solution | IndexedDB | 完整方案数据，支持离线 |

**索引设计**：

```typescript
// Dexie.js 索引配置
db.version(1).stores({
  extractions: 'id, url, platform, capturedAt',
  solutions: 'id, extractionId, *tags, starred, archived, createdAt, [starred+createdAt], groupId'
});
```

### 4.4 存储截断规则

> **约束**：单条记录（Extraction + 关联 Solutions 聚合后）持久化前执行 500KB 硬限制

#### 截断策略

| 场景 | 处理方式 | 用户提示 |
|-----|---------|---------|
| 单条 Extraction 超过 500KB | 优先截断 `originalText` 尾部，保留前 20,000 字符 | "内容过长，已截断保存（≤500KB）" |
| 截断后仍超限 | 继续截断 `summary` 至 500 字符 | 同上 |
| 评论页超长内容 | 按 8,000 字符分块，仅保存前 N 块（确保总大小≤500KB） | "评论过多，已截取部分内容" |
| 存储失败 | 记录错误日志，提示用户 | "保存失败，请稍后重试" |

#### 截断字段标记

```typescript
interface Extraction {
  // ... 其他字段 ...
  truncated: boolean;            // 是否被截断
  truncatedFields?: string[];    // 被截断的字段列表 ['originalText', 'summary']
  originalLength?: number;       // 截断前原始长度（用于统计）
}
```

### 4.5 Side Panel UI 规范

#### 页面结构

Side Panel 包含以下主要视图：

```
┌─────────────────────────────────────────┐
│              Side Panel                  │
├─────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │
│  │ 提炼视图 │  │ 方案库  │  │  设置   │ │
│  │ (默认)  │  │         │  │         │ │
│  └─────────────┘  └─────────────┘  └─────────────┘ │
└─────────────────────────────────────────┘
```

#### 视图1：提炼视图（当前页面分析）

```
┌─────────────────────────────────────────┐
│ Demand Radar           [方案库] [⚙️]    │
├─────────────────────────────────────────┤
│ 📄 当前页面                              │
│ ┌─────────────────────────────────────┐ │
│ │ r/SaaS - Why is there no good...   │ │
│ │ reddit.com · 可分析                 │ │
│ └─────────────────────────────────────┘ │
│                                         │
│       ┌─────────────────────┐          │
│       │   🔍 提炼此页面     │          │
│       └─────────────────────┘          │
├─────────────────────────────────────────┤
│ 📊 提炼结果                    [骨架屏] │
│ ─────────────────────────────────────── │
│ 📋 页面摘要                                 │
│ ┌─────────────────────────────────────┐ │
│ │ 用户讨论现有 PDF 工具的痛点，主要   │ │
│ │ 集中在价格、功能臃肿、批量处理...   │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 💡 发现 2 个产品机会                      │
│ ─────────────────────────────────────── │
│ ┌─────────────────────────────────────┐ │
│ │ ☑️ 方案 1                    [展开] │ │
│ │ 本地 PDF 批量处理工具                │ │
│ │ 本地运行 · 一次买断 · 批量操作        │ │
│ └─────────────────────────────────────┘ │
│ ┌─────────────────────────────────────┐ │
│ │ ☐ 方案 2                    [展开] │ │
│ │ 隐私优先的在线 PDF 工具              │ │
│ │ 端到端加密 · 按需付费 · 轻量功能      │ │
│ └─────────────────────────────────────┘ │
│                                         │
├─────────────────────────────────────────┤
│        [💾 保存选中的 1 个方案]         │
└─────────────────────────────────────────┘
```

#### 视图2：方案详情（展开状态）

```
┌─────────────────────────────────────────┐
│ ← 返回                       ⭐ 📤 ⋮     │
├─────────────────────────────────────────┤
│ 💡 本地 PDF 批量处理工具                 │
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ 一款本地运行、一次买断的轻量工具，   │ │
│ │ 专注 PDF 批量合并、拆分、压缩，      │ │
│ │ 面向需要频繁处理 PDF 的办公人员      │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ ✨ 核心差异点                            │
│ • 本地运行，保护隐私                    │
│ • 一次买断，无订阅                      │
│ • 专注批量操作，不做复杂编辑            │
│                                         │
├─────────────────────────────────────────┤
│ 📊 为什么有机会                          │
├─────────────────────────────────────────┤
│                                         │
│ 😫 用户痛点                              │
│ • 现有工具太贵                          │
│ • 在线工具担心隐私                      │
│ • 功能太复杂，只需要简单操作            │
│                                         │
│ 🏢 竞品及其不足                          │
│ • Adobe Acrobat — 订阅制，功能臃肿      │
│ • Smallpdf — 免费版限制多，要上传云端   │
│ • iLovePDF — 在线工具，隐私顾虑         │
│                                         │
├─────────────────────────────────────────┤
│ 💬 原文证据 (3)                   [展开] │
│ ┌─────────────────────────────────────┐ │
│ │ "Every tool wants $20/mo just to    │ │
│ │  merge some PDFs"                   │ │
│ ├─────────────────────────────────────┤ │
│ │ "Don't want to upload sensitive     │ │
│ │  contracts to some random website"  │ │
│ └─────────────────────────────────────┘ │
│                                         │
├─────────────────────────────────────────┤
│ 🔗 来源                                 │
│ r/SaaS · "Why is there no good..."     │
│ 2小时前                  [打开原文 ↗]   │
├─────────────────────────────────────────┤
│ 🏷️ [SaaS创意] [已验证] [+ 添加]         │
├─────────────────────────────────────────┤
│ 📝 我的笔记                      [编辑] │
│ ┌─────────────────────────────────────┐ │
│ │ 可以用 pdf-lib + Electron 做        │ │
│ │ 竞品定价 $20-50，可以定 $29 一次买断 │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

#### 视图3：方案库列表

```
┌─────────────────────────────────────────┐
│ ← 返回提炼                 方案库    [⚙️] │
├─────────────────────────────────────────┤
│ 🔍 搜索方案...                          │
├─────────────────────────────────────────┤
│ 筛选: [全部▾] [标签▾] [⭐收藏] [📁归档] │
├─────────────────────────────────────────┤
│                                         │
│ ⭐ 本地 PDF 批量处理工具                  │
│                                         │
│ 本地运行 · 一次买断 · 批量操作            │
│                                         │
│ 🏢 vs Adobe, Smallpdf                   │
│                                         │
│ r/SaaS · 2小时前                        │
│ [SaaS创意] [已验证]                      │
│ ─────────────────────────────────────── │
│    隐私优先的在线 PDF 工具               │
│    端到端加密 · 按需付费 · 轻量功能       │
│    r/SaaS · 2小时前                      │
│    [SaaS创意]                           │
│ ─────────────────────────────────────── │
│ ⭐ 本地化翻译工具需求                    │
│    本地运行 · 一次买断 · 批量操作         │
│    知乎 · 昨天                          │
│    [工具] [已验证]                       │
│ ─────────────────────────────────────── │
│    ... 更多方案                         │
│                                         │
├─────────────────────────────────────────┤
│ 共 24 个方案 · 5 个收藏                 │
└─────────────────────────────────────────┘
```

#### 视图4：去重分析 (P1)

```
┌─────────────────────────────────────────┐
│ 方案库                    [🔍 分析重复] │
├─────────────────────────────────────────┤
│                                         │
│ 📊 发现 2 组相似方案                    │
│ ┌─────────────────────────────────────┐ │
│ │ 📁 PDF 工具需求 (3 条相似)           │ │
│ │                                     │ │
│ │ • 本地 PDF 批量处理工具              │ │
│ │ • 简单的 PDF 合并工具                │ │
│ │ • 离线 PDF 编辑器                    │ │
│ │                                     │ │
│ │ 💡 这些方案都指向同一产品方向：      │ │
│ │    本地化、轻量级的 PDF 处理工具     │ │
│ │                                     │ │
│ │ [✓ 合并为一组]         [✗ 保持独立] │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ 📁 笔记工具需求 (2 条相似)           │ │
│ │ ...                                 │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

#### 交互规范

| 交互 | 行为 | 说明 |
|-----|------|------|
| 点击扩展图标 | 打开/关闭 Side Panel | 切换显示状态 |
| 点击「提炼此页面」 | 提取内容 + LLM 提炼方案 | 显示骨架屏，完成后渲染结果 |
| 勾选方案 | 选中/取消选中 | 控制哪些方案被保存 |
| 点击「保存选中」 | 保存到 IndexedDB | 仅保存勾选的方案 |
| 点击方案卡片 | 展开详情 | 显示完整信息和操作 |
| 点击 ⭐ | 切换收藏状态 | 收藏的方案优先显示 |
| 点击「打开原文」 | 新标签页打开来源 | 验证上下文 |
| 搜索输入 | 实时筛选 | 防抖 300ms |
| 点击「分析重复」 | 批量分析整个方案库 | LLM 去重分组，用户可合并 |

#### 加载状态

```
分析中状态（骨架屏）:
┌─────────────────────────────────────────┐
│ 📊 提炼中...                            │
│ ████████████░░░░░░░░ 60%               │
│ ─────────────────────────────────────── │
│ ┌─────────────────────────────────────┐ │
│ │ ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ │ │
│ │ ░░░░░░░░░░░░░░░░░                   │ │
│ └─────────────────────────────────────┘ │
│ ┌─────────────────────────────────────┐ │
│ │ ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘

错误状态:
┌─────────────────────────────────────────┐
│ ⚠️ 提炼失败                             │
│ API 配额已用尽，请检查您的 API Key       │
│ ┌─────────────────────────────────────┐ │
│ │ 已保存原文，待后续分析               │ │
│ └─────────────────────────────────────┘ │
│ [重试] [查看原文]                       │
└─────────────────────────────────────────┘
```

### 4.6 LLM 配置设计

#### 多服务商支持

```typescript
interface LLMConfig {
  provider: 'openai' | 'google' | 'deepseek' | 'custom';
  apiKey: string;
  baseUrl?: string;              // 自定义 API 地址（可选）
  modelName?: string;            // 自定义模型名（可选）
}

// 预设配置
const PROVIDER_PRESETS = {
  openai: {
    baseUrl: 'https://api.openai.com/v1',
    defaultModel: 'gpt-4o-mini',
  },
  google: {
    baseUrl: 'https://generativelanguage.googleapis.com/v1beta',
    defaultModel: 'gemini-1.5-flash',
  },
  deepseek: {
    baseUrl: 'https://api.deepseek.com/v1',
    defaultModel: 'deepseek-chat',
  },
  custom: {
    baseUrl: '',  // 用户填写
    defaultModel: '',
  },
};
```

#### 设置页面 UI

```
┌─────────────────────────────────────────┐
│ ⚙️ LLM 配置                             │
├─────────────────────────────────────────┤
│                                         │
│ 服务商                                   │
│ ┌─────────────────────────────────────┐ │
│ │ ○ OpenAI                            │ │
│ │ ○ Google (Gemini)                   │ │
│ │ ● DeepSeek                          │ │
│ │ ○ 自定义                             │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ API Key *                               │
│ ┌─────────────────────────────────────┐ │
│ │ sk-xxxxxxxxxxxxxxxxxxxxxxxx        │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ Base URL（可选，使用代理时填写）           │
│ ┌─────────────────────────────────────┐ │
│ │ https://api.deepseek.com/v1        │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 模型名称（可选）                          │
│ ┌─────────────────────────────────────┐ │
│ │ deepseek-chat                       │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ [测试连接]                    [保存配置] │
└─────────────────────────────────────────┘
```

**降级策略**：
- 离线摘要模式：使用 Readability 生成摘要，无需 API Key
- 多服务商配置：降低单一服务商的依赖

---

## 五、隐私与数据合规

### 5.1 数据最小化原则

| 原则 | 实施方式 |
|-----|---------|
| **按需采集** | 仅在用户主动触发时提取页面内容，不后台自动采集 |
| **最小上下文** | 发送给 LLM 的内容经过裁剪，仅保留分析必需的文本 |
| **本地优先** | 所有数据默认存储在本地 IndexedDB，不强制上传 |
| **用户可控** | 用户可随时查看、导出、删除所有存储的数据 |

### 5.2 站点白名单/黑名单

```typescript
interface SiteFilterConfig {
  mode: 'whitelist' | 'blacklist' | 'all'; // MVP 默认 whitelist
  whitelist: string[];  // 仅在这些站点启用 (如 ['reddit.com', 'zhihu.com'])
  blacklist: string[];  // 在这些站点禁用 (如 ['mail.google.com', 'bank.*'])
}
```

**默认策略 (MVP)**：默认开启白名单模式，安装引导提示用户勾选推荐站点（Reddit/知乎）或添加自定义域名；通用网页需用户手动授权当前域名后再注入。

**默认黑名单** (内置，用户可修改)：
- `*://*.bank.*/*`
- `*://mail.*/*`
- `*://*.gov.*/*`
- `*://*/login*`
- `*://*/account*`

### 5.3 敏感信息过滤

> **核心原则**：本地存储保留原文，PII 脱敏仅在发送给 LLM 之前执行。

**PII (个人身份信息) 过滤规则**：

| 类型 | 检测模式 | 处理方式 |
|-----|---------|---------|
| 邮箱 | `[\\w.-]+@[\\w.-]+\\.\\w+` | 替换为 `[EMAIL]` |
| 电话 | `1[3-9]\\d{9}` / `\\d{3}-\\d{4}-\\d{4}` | 替换为 `[PHONE]` |
| 身份证 | `\\d{17}[\\dXx]` | 替换为 `[ID]` |
| 信用卡 | `\\d{4}[\\s-]?\\d{4}[\\s-]?\\d{4}[\\s-]?\\d{4}` | 替换为 `[CARD]` |
| IP 地址 | `\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}` | 替换为 `[IP]` |

**LLM 传输脱敏**：
- **仅在发送前执行 PII 过滤**，本地 IndexedDB 存储原文
- 限制单次传输文本长度 ≤ 8000 tokens
- 不传输页面 cookies、localStorage 等敏感数据

**脱敏时机说明**：

| 阶段 | 是否脱敏 | 说明 |
|-----|---------|------|
| 内容提取 | 否 | 提取原始内容 |
| 本地存储 (IndexedDB) | 否 | 保留原文，便于用户查证 |
| 发送至 LLM | **是** | 执行 PII 过滤后再发送 |

### 5.4 用户数据权利

| 权利 | 实现方式 |
|-----|---------|
| **查看权** | 设置页 → 数据管理 → 查看所有存储数据 |
| **导出权** | 一键导出为 JSON/CSV，包含所有用户数据 |
| **删除权** | 单条删除 / 批量删除 / 一键清空所有数据 |
| **离线处理** | 无网络时默认本地处理，不尝试外传 |

---

## 六、非功能需求

### 6.1 分场景性能指标

#### 场景分类与时间阈值

| 场景 | 内容规模 | 提取时间 | LLM提炼时间 | 总时间阈值 | 降级策略 |
|-----|---------|---------|-----------|-----------|---------|
| **单页文章** | < 3000 字 | < 1s | < 5s | **< 6s** | - |
| **长帖子** | 3000-10000 字 | < 2s | < 8s | **< 10s** | >8s 显示"后台继续提炼"通知 |
| **多评论页** | > 50 条评论 | < 3s | < 10s | **< 13s** | >8s 显示进度条 + 托盘通知 |
| **超长内容** | > 10000 字 | < 3s | - | - | 提示"内容过长，已截取前8000字"；存储截断至 500KB |

#### 降级与失败处理

| 情况 | 处理方式 | 用户提示 |
|-----|---------|---------|
| 提取超时 (>5s) | 返回已提取内容 | "部分内容提取完成" |
| LLM 超时 (>15s) | 存储原文，标记待分析 | "内容已保存，后台继续提炼" + 托盘通知 |
| LLM 失败 | 仅存储原文和基础摘要 | "AI 提炼暂不可用，已保存原文" |
| 网络离线 | 本地 Readability 摘要 | "离线模式：已生成基础摘要" |
| **存储超限 (>500KB)** | 截断 originalText/summary | "内容过长，已截断保存（≤500KB）" |

#### 内存与资源占用

| 指标 | 目标值 | 说明 |
|-----|-------|------|
| 常驻内存 | **< 80MB** | Background Service Worker 常驻 |
| 峰值内存 | **< 150MB** | 提炼大页面时的峰值 |
| CPU 占用 | < 5% (空闲) | 无操作时 |

**UI 组件加载策略**：
- Side Panel 作为主界面，提供完整功能
- 方案列表采用虚拟滚动，单次渲染 ≤ 20 条
- 图片/富文本预览延迟加载

### 6.2 兼容性要求

| 平台 | 要求 | 备注 |
|-----|------|------|
| Chrome | v100+ | MVP 主要平台 |
| Edge | v100+ | 兼容测试 |
| Firefox | v100+ | P1 适配 |
| Safari | 暂不支持 | MV3 兼容性问题 |

### 6.3 安全要求

#### 权限最小化

```json
// manifest.json 权限声明
{
  "permissions": [
    "activeTab",      // 仅当前激活标签页
    "storage",        // 本地存储
    "scripting",      // 动态注入内容脚本
    "sidePanel"       // Side Panel 支持
  ],
  "host_permissions": [
    "https://*.reddit.com/*",
    "https://*.zhihu.com/*"
  ],
  "optional_host_permissions": [
    "https://*/*",
    "http://*/*"
  ]
}
```

**不申请的权限**：
- `tabs` - 不需要访问所有标签页
- `history` - 不需要浏览历史
- `bookmarks` - 不需要书签
- `webRequest` - 不需要拦截请求

#### 内容脚本安全

| 措施 | 说明 |
|-----|------|
| **脚本隔离** | Content Script 运行在隔离环境，不与页面脚本共享作用域 |
| **XSS 防护** | 使用 DOMPurify 清理提取的 HTML 内容 |
| **CSP 遵守** | 不使用 `eval()`、内联脚本等违反 CSP 的代码 |
| **消息验证** | Runtime 消息通信验证 sender.id |

#### LLM 调用错误处理

**错误分类与前端提示**：

| 错误类型 | HTTP 状态码 | 前端提示文案 | 处理方式 |
|---------|-----------|-------------|---------|
| **API Key 无效** | 401 | "API Key 无效，请检查设置" | 引导用户到设置页 |
| **API Key 未配置** | - | "请先配置 API Key" | 显示配置引导 |
| **额度耗尽** | 429 | "API 调用额度已用尽，请检查账户" | 存储原文，标记待分析 |
| **请求超时** | timeout | "提炼超时，已保存原文待后续处理" | 存储原文，标记待分析 |
| **网络错误** | network error | "网络连接失败，已切换离线模式" | 使用 Readability 生成基础摘要 |
| **服务不可用** | 500/502/503 | "AI 服务暂时不可用，请稍后重试" | 存储原文，提供重试按钮 |
| **内容过长** | 400 (token limit) | "内容超出分析限制，已截取部分内容" | 截断后重试 |
| **其他错误** | - | "提炼失败：[错误信息]" | 存储原文，显示详细错误 |

**错误处理流程**：

```
LLM 调用失败
    │
    ├─► 网络错误 → 重试 1 次 → 仍失败 → 离线模式 (Readability 摘要)
    │
    ├─► 401 认证失败 → 提示检查 API Key → 引导到设置页
    │
    ├─► 429 额度耗尽 → 提示检查账户额度 → 存储原文
    │
    ├─► 超时 (>15s) → 后台继续 (60s) → 仍超时 → 存储原文，标记待分析
    │
    └─► 其他错误 → 存储原文，显示错误信息 + 重试按钮
```

**UI 错误状态示例**：

```
┌─────────────────────────────────────────┐
│ ⚠️ 提炼失败                             │
│ API Key 无效，请检查设置                 │
│ ─────────────────────────────────────── │
│ ┌─────────────────────────────────────┐ │
│ │ 已保存原文，配置后可重新提炼         │ │
│ └─────────────────────────────────────┘ │
│ [前往设置] [查看原文]                    │
└─────────────────────────────────────────┘
```

---

## 七、MVP 定义

### 7.1 MVP 范围

**包含**：
- [x] 一键提炼当前页面内容 (Reddit/知乎)
- [x] 通用提取需用户授权站点（默认白名单模式，安装引导推荐勾选）
- [x] LLM 方案提炼（用户自备 API Key，支持多服务商）
- [x] 方案评分展示 (痛点/竞品不足/核心差异点)
- [x] 本地存储方案列表 (IndexedDB)，单条记录≤500KB 自动截断
- [x] 基础搜索和标签筛选
- [x] Side Panel 界面
- [x] 站点白名单/黑名单（默认白名单模式）
- [x] PII 脱敏过滤（仅 LLM 发送前）
- [x] LLM 离线降级
- [x] **新增**: 用户主动触发的去重分析 (P1)

**不包含**：
- [ ] 云端同步服务器 → P1
- [ ] 账户系统 → P1
- [ ] 跨设备数据同步 → P1
- [ ] 批量分析 → P1
- [ ] 方案聚类（自动）→ P1（改为用户主动触发）
- [ ] Popup 快捷入口 → P1
- [ ] Twitter/X 深度适配 → P1
- [ ] 社区功能 → P2

### 7.2 成功指标与埋点

#### 北极星指标

| 指标 | 目标值 | 定义 |
|-----|-------|------|
| **周活跃留存** | ≥ 35% | 第 N 周活跃用户在 N+1 周仍活跃的比例 |
| **首次提炼→保存转化** | ≥ 40% | 完成首次提炼的用户中，保存至少 1 个方案的比例 |

#### 核心指标

| 指标 | 目标值 | 衡量方式 |
|-------|-------|---------|
| 安装量 | 500+ | Chrome 商店数据 |
| 周活跃用户 (WAU) | 100+ | 插件埋点 |
| 单用户周均使用次数 | 5+ | 插件埋点 |
| 用户满意度 | 4.0+ 星 | Chrome 商店评分 |
| **API Key 配置完成率** | ≥ 70% | 安装后 7 天内完成配置的用户比例 |

#### 埋点事件表

| 事件名 | 触发时机 | 关键参数 | 用途 |
|-------|---------|---------|------|
| `install` | 插件安装完成 | install_source, browser_version | 获客渠道分析 |
| `enable` | 插件启用 | - | 活跃度 |
| `first_extract` | 首次提取内容 | platform, content_length | 激活转化 |
| `extract` | 每次提取 | platform, content_length, duration_ms | 功能使用 |
| `refine_complete` | LLM 提炼完成 | solution_count, duration_ms, status | 核心功能质量 |
| `refine_fail` | LLM 提炼失败 | error_type, fallback_action | 错误监控 |
| `save_solution` | 保存方案 | solution_count, has_tags | 核心转化 |
| `storage_truncate` | 存储截断触发 | original_size, truncated_size | 容量监控 |
| `search` | 搜索方案库 | query_length, result_count | 功能使用 |
| `delete_solution` | 删除方案 | - | 用户行为 |
| `config_apikey` | 配置 API Key | provider (openai/claude/deepseek) | 配置完成率 |
| `config_apikey_success` | API Key 测试成功 | provider, response_time | 配置质量 |
| `revisit_day7` | 安装后第 7 天回访 | total_solutions_saved | 留存 |
| `analyze_duplicates` | 去重分析 | total_solutions, duplicate_groups | P1功能使用 |

**隐私说明**：
- 所有埋点数据匿名化，不包含用户身份信息
- 不上报页面 URL、提取内容、提炼结果等敏感数据
- 用户可在设置中关闭数据收集

---

## 八、技术选型建议

### 8.1 插件框架

| 选项 | 优点 | 缺点 | 推荐度 |
|-----|-----|------|-------|
| **Plasmo** | 现代化、React 支持、HMR | 学习曲线 | ⭐⭐⭐⭐⭐ |
| **WXT** | 轻量、多浏览器支持 | 社区较小 | ⭐⭐⭐⭐ |
| 原生开发 | 无依赖 | 开发效率低 | ⭐⭐ |

### 8.2 技术栈推荐

```
框架: Plasmo
UI: React + Tailwind CSS
状态管理: Zustand
本地存储: IndexedDB (Dexie.js)
内容提取: @mozilla/readability + Turndown
HTML清理: DOMPurify
加密: 删除（用户自管 API Key）
LLM: OpenAI API / Google Gemini / DeepSeek API (用户自备 Key)
埋点: 自建简易方案
同步 (P1): Supabase / Firebase
```

### 8.3 Week 0 技术验证

**新增阶段**：正式开发前增加 Week 0 技术验证 (3-5 天)

**验证内容**：
- [ ] 知乎内容提取 POC（是否需要登录、反爬情况）
- [ ] Reddit 内容提取 POC
- [ ] LLM Prompt 原型（手动测试 10 个样本）
- [ ] Side Panel API 基础 Demo
- [ ] 输出：技术可行性报告 + 风险清单

**知乎反爬应对预案**：
| 情况 | 应对 |
|-------|-----|
| 需要登录才能看内容 | 提示用户先登录，只提取可见内容 |
| 动态加载 | 只提取首屏已加载内容，提示用户手动展开 |
| 完全封禁 | 降级为通用提取器，知乎移至 P1 |

---

## 九、迭代路线图

### Phase 1 - MVP (6 周 + 1 周缓冲)

```
Week 0: 技术验证 (新增)
├── 目标: 知乎/Reddit提取器可行性 + LLM Prompt 原型
├── 里程碑: 知乎 30 条、Reddit 30 条页面测试通过率 ≥ 90%
├── 角色: 1 前端开发
└── 产出: 技术可行性报告 + 风险清单

Week 1: 提取稳定性
├── 目标: 知乎/Reddit提取器稳定可用
├── 里程碑: 知乎 30 条、Reddit 30 条页面测试通过率 ≥ 90%
├── 角色: 1 前端开发
└── 产出: Content Script + 平台适配器

Week 2: Side Panel 骨架
├── 目标: Side Panel 基本可用
├── 里程碑: 侧边栏展示提炼结果，支持基础交互
├── 角色: 1 前端开发
└── 产出: Side Panel 组件 + 设置页面

Week 3: LLM 接入 + 缓存
├── 目标: LLM 提炼流程完整
├── 里程碑: 方案合理性评分 ≥ 3.5/5 分 (20 条样本)
├── 角色: 1 前端开发
└── 产出: LLM 服务 + IndexedDB 存储 + 离线降级

Week 4: 安全 + 去重 + 打磨
├── 目标: PII 过滤、白名单/授权、去重分析功能完成
├── 里程碑: 用户主动去重分析可用，体验打磨完成
├── 角色: 1 前端开发
└── 产出: 安全模块 + 去重分析 + 埋点接入

Week 5: 测试 + 上架准备
├── 目标: 提交 Chrome 商店审核
├── 里程碑: 通过内部测试，准备商店素材
├── 角色: 1 前端开发 + 产品
└── 产出: 测试报告 + 商店页面 + 隐私政策

Week 6: 缓冲周
├── 用途: 应对平台变更、审核反馈、紧急 Bug
└── 如无问题则用于: P1 功能预研
```

### Phase 2 - 增强 (4-6 周)

```
├── 云端同步 + 账户系统 (见 附录E)
├── 高级分析功能 (批量分析)
├── Twitter/X 适配
├── Popup 快捷入口（可选，与 Side Panel 互补）
└── 多平台适配优化
```

### Phase 3 - 扩展 (持续)

```
├── 方案社区
├── 团队协作
└── AI 深度功能 (PRD生成、竞品关联)
```

---

## 十、风险与应对

| 风险 | 影响 | 概率 | 应对措施 |
|-----|-----|-----|---------|
| LLM API 成本过高 | 用户流失 | 中 | 支持多种模型、提供用量预估、费用预警机制 |
| 页面结构变化导致提取失败 | 功能不可用 | 高 | 平台适配器架构 + 回退策略 + 快速响应更新 (Week 0 验证) |
| 用户隐私担忧 | 口碑下降 | 中 | 透明的隐私政策、本地优先、PII 过滤、权限最小化 |
| 竞品快速跟进 | 市场份额 | 中 | 快速迭代、建立数据网络效应 |
| API Key 泄露 | 用户财产损失 | 低 | 使用指引、提醒定期轮换（删除加密） |
| Chrome 商店审核被拒 | 上线延期 | 中 | 预留缓冲周、提前研究审核政策、准备申诉材料 |
| 存储容量超限 | 数据丢失 | 低 | 500KB 截断策略、容量管理机制 |

---

## 十一、附录

### A. 竞品分析

| 竞品 | 定位 | 差异点 |
|-----|-----|-------|
| Glasp | 网页高亮笔记 | 我们聚焦方案提炼，非通用笔记 |
| Notion Web Clipper | 内容收藏 | 我们提供智能提炼，非简单存储 |
| ChatGPT 插件 | 通用 AI 助手 | 我们专注方案场景，体验更垂直 |

### B. 参考资料

- Chrome Extension Manifest V3 文档
- Plasmo 官方文档
- OpenAI API 文档
- Google Gemini API 文档
- DeepSeek API 文档
- Chrome Web Store 开发者政策

### C. Chrome 扩展数据声明与权限列表

#### 权限声明 (manifest.json)

```json
{
  "manifest_version": 3,
  "name": "Demand Radar",
  "version": "1.0.0",
  "permissions": [
    "activeTab",
    "storage",
    "scripting",
    "sidePanel"
  ],
  "host_permissions": [
    "https://*.reddit.com/*",
    "https://*.zhihu.com/*"
  ],
  "optional_host_permissions": [
    "https://*/*",
    "http://*/*"
  ],
  "content_scripts": [
    {
      "matches": ["*://*.reddit.com/*", "*://*.zhihu.com/*"],
      "js": ["content-platform.js"],
      "run_at": "document_idle"
    }
  ],
  "side_panel": {
    "default_path": "sidepanel.html"
  }
}
```

**内容脚本注入策略**：

| 策略 | 适用场景 | 实现方式 |
|-----|---------|---------|
| 声明式注入 | Reddit/知乎等已知平台 | manifest.json content_scripts |
| 动态注入 | 通用网页（需用户授权域名） | `chrome.scripting.executeScript` 按需注入 + `optional_host_permissions` |

> **说明**：已知平台在 manifest 中声明固定域名；通用网页需先调用 `chrome.permissions.request` 获取当前域名权限，用户同意后才注入通用提取脚本，默认不在未授权站点后台运行。

#### Chrome Web Store 数据披露

| 披露项 | 声明内容 |
|-------|---------|
| **数据收集** | 收集用户主动提取的网页内容用于提炼方案 |
| **数据使用** | 本地存储 + 发送至用户配置的 LLM API 进行提炼 |
| **数据共享** | 不与第三方共享用户数据（LLM API 除外，用户自行配置） |
| **数据存储** | 存储在本地 IndexedDB |
| **数据删除** | 用户可随时删除所有数据 |

#### 隐私政策要点

1. 我们仅在用户主动触发时提取页面内容
2. 提取的内容经过 PII 脱敏后发送至用户配置的 LLM 服务（本地存储保留原文）
3. 所有数据默认存储在用户本地设备
4. 我们不运营任何服务器存储用户数据 (MVP 阶段)
5. 用户可随时导出或删除所有数据

### D. 验收测试集规范

#### 正文识别测试集

| 平台 | 样本数 | 样本类型 | 标注内容 |
|-----|-------|---------|---------|
| Reddit | 30+ | 帖子正文 | 预期提取的正文边界 |
| 知乎 | 30+ | 问答内容 | 预期提取的问题+回答 |
| 通用 | 20+ | 博客/新闻 | 预期提取的文章正文 |

#### 准确率/召回率计算

```
准确率 = 正确提取的字符数 / 实际提取的总字符数
召回率 = 正确提取的字符数 / 应该提取的总字符数

判定标准:
- 正确: 提取内容与人工标注重叠度 ≥ 80%
- 遗漏: 应提取内容未被提取
- 噪音: 不应提取的内容被提取 (广告、导航等)
```

#### LLM 方案提炼质量评估 (v2.0 修订)

**评估维度**：
| 维度 | 评估问题 | 评分 |
|-----|---------|------|
| 方向合理性 | 提炼的方案是否合理？能否解决用户痛点？ | 1-5 分 |
| 差异点准确 | 核心差异点是否抓住了竞品的真正不足？ | 1-5 分 |
| 证据支撑 | 痛点和竞品不足是否有原文证据支撑？ | 1-5 分 |
| 可操作性 | 看完是否知道可以做什么产品？ | 1-5 分 |

**评估方法**：
1. 准备 50 条测试样本（来自 Reddit/知乎的真实吐槽帖）
2. LLM 输出方案
3. 2 位评审员独立打分（双盲）
4. 计算平均分和评审员一致性（Kappa ≥ 0.6）

**验收标准**：
- 平均分 ≥ 3.5 / 5 分
- 「可操作性」维度 ≥ 3.5 分（核心指标）

#### 存储截断测试

| 测试场景 | 预期行为 | 验收标准 |
|---------|---------|---------|
| 正常内容 (<500KB) | 完整存储 | truncated: false |
| 超长内容 (>500KB) | 截断后存储 | truncated: true, 用户收到提示 |
| 截断后查询 | 截断字段可查 | truncatedFields 记录被截断字段 |

#### 质量控制指标 (新增)

| 指标 | 定义 | 目标 | 计算方式 |
|-----|------|------|---------|
| 空洞方案率 | 输出的方案过于泛泛，无具体方向 | ≤ 20% | 人工判定「是否空洞」 |
| 证据缺失率 | 痛点/竞品不足没有原文支撑 | ≤ 15% | validation.quotes 为空的比例 |
| 用户删除率 | 用户保存后又删除的比例 | ≤ 15% | 删除数 / 保存数 |

### E. P1 同步方案 (Phase 2)

> 本节内容在 Phase 2 实现，MVP 阶段不适用

#### 同步架构

```
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│   设备 A     │     │   云端服务    │     │   设备 B     │
│  (Chrome)    │────▶│  (Supabase)  │◀────│  (Edge)      │
└──────────────┘     └──────────────┘     └──────────────┘
       │                    │                    │
       ▼                    ▼                    ▼
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│ IndexedDB    │     │  PostgreSQL  │     │ IndexedDB    │
│ (本地缓存)   │     │  (主数据库)   │     │ (本地缓存)   │
└──────────────┘     └──────────────┘     └──────────────┘
```

#### P1 数据模型扩展

```typescript
interface Solution {
  // ... MVP 字段 ...

  // P1 同步字段
  sync: {
    localVersion: number;        // 本地版本号
    serverVersion: number;       // 服务器版本号
    lastSyncedAt: Date;          // 最后同步时间
    status: 'synced' | 'pending' | 'conflict';
  };
}
```

#### 同步策略

| 策略 | 描述 | 适用场景 |
|-----|------|---------|
| **本地优先** | 所有操作先写入本地，后台异步同步 | 保证离线可用 |
| **增量同步** | 只同步变更数据，非全量覆盖 | 节省带宽 |
| **冲突解决** | 以最后修改时间为准，保留两个版本 | 多设备编辑 |
| **实时推送** | WebSocket 推送其他设备的变更 | 在线状态 |

---

## 变更记录

| 版本 | 日期 | 变更内容 | 作者 |
|-----|-----|---------|-----|
| 1.0 | 2025-12-08 | 初稿创建 | - |
| 1.1 | 2025-12-08 | MVP数据策略澄清；隐私合规补充；验收标准细化；分场景性能指标；埋点事件表；平台适配器；安全配额控制；路线图资源对齐 | - |
| 1.2 | 2025-12-08 | UI架构从Popup改为Side Panel；数据模型改为两层结构（Extraction + Demand）；以单个需求为最小管理单元；新增 Side Panel UI 规范（4.4节） | - |
| 1.3 | 2025-12-09 | **内容脚本**：支持通用网页（host_permissions: all_urls + 动态注入）；**路线图**：Week 2 统一为 Side Panel；**PII策略**：明确本地存储保留原文，仅发送前脱敏；**存储约束**：新增 500KB 截断规则（4.4节）；**验收标准**：补充存储截断测试用例 | - |
| 1.4 | 2025-12-09 | **删除 Chrome Storage Sync 备份功能**：移除轻量元数据备份、SyncBackupIndex、配额管理（原4.5节）等相关内容；MVP 采用纯本地 IndexedDB 方案，跨设备同步整体移至 P1 云端方案 | - |
| 1.5 | 2025-12-09 | **简化 LLM 安全策略**：删除 5.5 LLM 调用安全节（API Key 加密、调用限制、费用预警）和 6.3 API Key 安全小节；**增强错误提示**：重构 LLM 失败降级为「LLM 调用错误处理」，新增详细的错误分类与前端提示文案规范 | - |
| **2.0** | **2025-12-09** | **重大重构**：产品定位从"需求信号收集器"转向"解决方案提炼器"；数据模型从"痛点评分"改为"solution + validation"双层结构；Reddit 提升为 MVP P0；新增多服务商LLM配置；新增用户主动触发的去重分析；Week 0 技术验证；路线图调整；解决评审建议中的所有战略层问题 | - |

---

## 十二、LLM Prompt 设计规范 (新增)

### 12.1 核心 Prompt 模板

```markdown
# 角色
你是一个资深产品经理，擅长从用户吐槽中提炼可执行的产品方案。

# 任务
分析给定的网页内容，提炼出 2-3 个潜在的产品机会，每个机会包含：
1. 产品方案（一句话描述 + 详细说明）
2. 目标用户
3. 核心差异点（3-5个）
4. 相关竞品及不足
5. 用户痛点（原文摘录）
6. 原文证据（3-5个关键摘录）

# 输出格式
JSON 格式，包含 solutions 数组，每个 solution 包含：
- title: 产品名/一句话描述
- description: 详细描述（2-3句）
- targetUser: 目标用户
- keyDifferentiators: 核心差异点数组
- validation: {
    painPoints: 痛点数组（原文摘录）,
    competitors: 竞品名称数组,
    competitorGaps: 竞品不足数组,
    quotes: 原文证据数组（3-5个）
  }

# 要求
1. 只提炼有明确产品方向的机会，避免空洞概念
2. 差异点必须基于竞品不足，来源可靠
3. 每个方案至少包含 2 个原文证据
4. 输出结果必须严格符合 JSON 格式
```

### 12.2 Prompt 测试规范

| 测试场景 | 样本数量 | 目标指标 |
|---------|---------|---------|
| Reddit 吐槽帖 | 20 条 | 方案合理性 ≥ 3.5/5 |
| 知乎问答 | 20 条 | 证据覆盖率 ≥ 80% |
| 综合样本 | 50 条 | Top3 方案命中率 ≥ 70% |

---

## 十三、总结

### v2.0 核心成就

**战略层面**：
1. ✅ 产品定位清晰：从"需求收集"转向"方案提炼"，符合 LLM 能力边界
2. ✅ 用户-平台匹配：Reddit P0 + 知乎 P0，覆盖全球 + 中国市场
3. ✅ 差异化明确：与 ChatGPT 互补，而非正面竞争

**架构层面**：
1. ✅ 数据模型革新：solution + validation 双层结构，可操作性强
2. ✅ 需求聚合机制：用户主动去重分析，避免资源浪费
3. ✅ 多服务商支持：降低使用门槛，提高可用性

**执行层面**：
1. ✅ Week 0 验证：降低技术风险
2. ✅ 6 周路线图：更稳健的开发节奏
3. ✅ 验收标准量化：质量可控

**与评审建议的对应**：

| 评审问题 | v2.0 解决方案 |
|---------|-------------|
| 1.1 价值主张模糊 | 转向"解决方案提炼器"，明确 LLM 职责边界 |
| 1.2 与 ChatGPT 差异不足 | 强化三大差异点，增加互补策略 |
| 2.1 用户-平台错配 | Reddit 提升为 P0，并行开发 |
| 3.1 首次使用门槛高 | 多服务商配置 + 离线摘要模式 |
| 4.1 数据模型不合理 | solution + validation 双层结构 |
| 7.1 5周开发可行性 | 增加 Week 0 + 6周路线图 |

v2.0 解决了评审建议中的所有战略层问题，为开发提供了清晰的路线图和可执行的技术方案。
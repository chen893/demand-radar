# Demand Radar - 产品需求文档 (PRD)

> 版本: 1.2
> 更新日期: 2025-12-08
> 产品负责人: [待定]
> 文档状态: 修订版

---

## 一、产品概述

### 1.1 产品定位

**Demand Radar（需求雷达）** 是一款浏览器插件，帮助用户在日常浏览网页时自动捕捉、分析和积累潜在的市场需求与商业机会。

**一句话描述**：把每一次浏览，变成发现商业机会的雷达扫描。

### 1.2 产品背景

**问题洞察**：
- 产品经理、创业者、投资人每天浏览大量网页，其中蕴含丰富的需求信号
- 这些信号散落在评论区、论坛帖子、社交媒体中，容易被遗忘
- 缺乏系统化的方法将碎片化信息转化为可行动的洞察

**解决方案**：
- 通过浏览器插件无缝融入用户日常工作流
- 利用 LLM 智能提取和分析页面中的需求信号
- 本地优先存储，构建个人需求知识库

### 1.3 产品愿景

成为专业人士发现市场机会的第一入口，让每个人都拥有"需求嗅觉"超能力。

---

## 二、目标用户

### 2.1 核心用户画像

| 用户类型 | 特征描述 | 核心诉求 | 使用频率 |
|---------|---------|---------|---------|
| **独立开发者** | 寻找 Side Project 方向，关注 Indie Hackers/Reddit | 发现可执行的产品创意 | 高频 |
| **产品经理** | 负责竞品分析和用户研究 | 高效捕捉用户痛点 | 高频 |
| **创业者** | 寻找创业方向或验证想法 | 系统化的机会发现 | 中频 |
| **投资人/分析师** | 研究行业趋势和投资标的 | 比市场更早发现信号 | 中频 |

### 2.2 用户优先级

**P0 (MVP 核心用户)**: 独立开发者、产品经理
**P1 (扩展用户)**: 创业者、内容创作者
**P2 (未来用户)**: 投资人、企业战略部门

---

## 三、用户场景

### 3.1 MVP 核心场景

#### 场景 1：Reddit 痛点挖掘 (MVP 必保)

> **用户**：独立开发者小李
> **场景**：浏览 r/SaaS 时看到一个吐槽帖
> **行为**：点击插件图标，插件自动提取帖子内容及评论
> **结果**：LLM 分析出 3 个潜在需求点，标注痛点强度和付费意愿信号
> **价值**：小李将该需求加入个人库，一周后发现类似需求出现 5 次，决定深入调研

#### 场景 2：知乎问答分析 (MVP 必保)

> **用户**：产品经理小王
> **场景**：浏览知乎某个行业问题下的高赞回答
> **行为**：点击插件提取问题和多个回答内容
> **结果**：插件识别出用户反复提及的痛点，生成需求洞察
> **价值**：发现目标用户群体的真实诉求，为产品规划提供依据

### 3.2 P1 扩展场景

#### 场景 3：Twitter/X 舆情监控 (P1 受限支持)

> **用户**：创业者老张
> **场景**：关注某个话题标签下的用户讨论
> **行为**：插件提取时间线内容
> **结果**：识别出用户抱怨和期望
> **限制**：受平台 API 限制，仅支持公开可见内容

#### 场景 4：跨设备需求回顾 (P1)

> **用户**：创业者老张
> **场景**：白天用公司电脑浏览，晚上用个人电脑复盘
> **行为**：打开插件的"需求库"面板
> **结果**：所有捕捉的需求通过云端同步，可按时间/来源/热度筛选
> **价值**：系统化积累 2 个月后，发现一个反复出现的需求模式

### 3.3 平台适配器表

| 平台 | 优先级 | 解析方案 | 分页/懒加载处理 | 回退策略 |
|-----|-------|---------|---------------|---------|
| **Reddit** | P0 MVP必保 | 专用选择器提取帖子+评论树 | 监听滚动加载，增量提取 | Readability 纯正文提取 |
| **知乎** | P0 MVP必保 | 专用选择器提取问答内容 | 监听"查看全部"展开 | Readability 纯正文提取 |
| **Twitter/X** | P1 受限支持 | 时间线公开内容提取 | 仅首屏可见内容 | 提示用户手动复制 |
| **Hacker News** | P1 | 评论树结构化提取 | 递归加载子评论 | 纯文本提取 |
| **通用网页** | P0 | @mozilla/readability | 不处理 | 返回 document.body.innerText |

---

## 四、功能需求

### 4.1 功能架构

```
┌─────────────────────────────────────────────────────────┐
│                    Demand Radar                          │
├─────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │  内容提取层  │  │  智能分析层  │  │  数据管理层  │     │
│  ├─────────────┤  ├─────────────┤  ├─────────────┤     │
│  │ • 页面文本   │  │ • LLM 分析   │  │ • IndexedDB │     │
│  │ • 评论抓取   │  │ • 需求识别   │  │ • 轻量备份   │     │
│  │ • 元数据     │  │ • 痛点评分   │  │ • 标签管理   │     │
│  │ • 正文提取   │  │ • 离线降级   │  │ • 搜索过滤   │     │
│  └─────────────┘  └─────────────┘  └─────────────┘     │
├─────────────────────────────────────────────────────────┤
│                      用户界面层                          │
│  ┌─────────────┐  ┌─────────────┐                      │
│  │ Side Panel  │  │  设置页面    │                      │
│  │  (侧边栏)   │  │             │                      │
│  └─────────────┘  └─────────────┘                      │
└─────────────────────────────────────────────────────────┘
```

### 4.2 功能清单

#### P0 - MVP 必备功能

| 功能模块 | 功能点 | 描述 | 验收标准 |
|---------|-------|------|---------|
| **内容提取** | 一键提取 | 点击插件提取当前页面核心内容 | 见 [6.1 分场景性能指标] |
| | 智能正文识别 | 自动识别文章/帖子正文，过滤噪音 | 测试集：Reddit/知乎各≥30个页面；准确率≥90%，召回率≥85%（人工标注对照） |
| | 评论提取 | 提取页面评论/回复内容 | 测试集：每站点≥30个帖子；结构化提取成功率≥85%，回退到纯文本时有明确提示 |
| **智能分析** | 需求识别 | LLM 分析内容，提取潜在需求 | 人工标注100条样本对照，Top3需求命中率≥70% |
| | 痛点评分 | 对识别的需求进行多维度评分 | 包含频率/强度/付费意愿维度，评分与人工判断相关性≥0.6 |
| | 摘要生成 | 生成页面内容的简洁摘要 | 摘要长度100-200字，覆盖核心信息点 |
| | 离线降级 | LLM 不可用时的降级处理 | 存储原文+基础摘要，标记"待分析" |
| **数据管理** | 本地存储 | IndexedDB 持久化存储 | 支持离线访问，单条记录≤500KB |
| | 轻量备份 | Chrome Storage Sync 备份元数据 | 仅同步 id/url/title/tags/starred，≤100KB quota |
| | 需求列表 | 查看所有捕捉的需求 | 支持时间排序、标签筛选 |
| | 基础搜索 | 关键词搜索需求库 | 响应时间 < 500ms (1000条记录内) |
| **用户界面** | Side Panel | 侧边栏展示分析结果、需求列表和快捷操作 | 首次打开 < 500ms，清晰展示需求卡片 |
| | 设置页面 | API Key 配置、站点白/黑名单 | 配置项持久化保存，敏感配置加密 |

**MVP 数据策略说明**：
- MVP 阶段采用 **纯本地 IndexedDB + Chrome Storage Sync 轻量备份** 方案
- IndexedDB 存储完整数据（原文、分析结果、用户标注）
- Chrome Storage Sync 仅备份元数据索引（id、url、title、tags、starred），用于换设备时快速恢复入口
- 不包含云端服务器、账户系统、实时同步功能

#### P1 - 增强功能

| 功能模块 | 功能点 | 描述 | 备注 |
|---------|-------|------|------|
| **云端同步** | 账户系统 | 邮箱注册/登录 | 见 [附录E P1同步方案] |
| | 跨设备同步 | 需求数据实时同步 | 见 [附录E P1同步方案] |
| | 数据导出 | 导出为 JSON/CSV/Markdown | |
| **高级分析** | 需求聚类 | 自动将相似需求归类 | 不纳入MVP测评 |
| | 趋势追踪 | 追踪需求热度变化 | |
| | 批量分析 | 一次分析多个页面/评论 | 不纳入MVP测评 |
| **平台扩展** | Twitter/X 适配 | 受限支持公开内容提取 | 受平台限制 |
| | Popup 快捷入口 | 轻量级快捷操作入口 | 可选，与 Side Panel 互补 |
| **个性化** | 自定义标签 | 用户自定义标签体系 | |
| | 分析偏好 | 设置关注的行业/领域 | |
| | 快捷键 | 自定义快捷键触发 | |

#### P2 - 远期功能

| 功能点 | 描述 |
|-------|------|
| 需求社区 | 匿名分享/订阅他人发现的需求 |
| 竞品关联 | 自动关联相关竞品信息 |
| 时间旅行 | 查看需求的历史演变 |
| AI 副驾驶 | 直接生成 PRD/用户故事 |
| 团队协作 | 团队共享需求库 |

### 4.3 MVP 数据模型

**设计原则**：采用两层数据结构，以**单个需求为最小管理单元**，同时保留提取上下文。

```
┌─────────────────────────────────────────────────────┐
│                    数据关系                          │
├─────────────────────────────────────────────────────┤
│   Extraction（提取记录）         Demand（需求）      │
│   ┌─────────────────┐          ┌─────────────────┐  │
│   │ 来源页面信息     │    ┌────▶│ 独立需求实体    │  │
│   │ 原文 + 摘要     │    │     │ 可单独管理      │  │
│   │ 分析状态        │────┤     │ 标签/收藏/笔记  │  │
│   └─────────────────┘    │     └─────────────────┘  │
│                          │     ┌─────────────────┐  │
│                          └────▶│ ...更多需求     │  │
│                                └─────────────────┘  │
│                 1 : N 关系                          │
└─────────────────────────────────────────────────────┘
```

**这样设计的好处**：
- 用户可单独保存/删除/标记某个需求，而非整个页面
- 支持跨页面的需求聚合和趋势分析
- 便于后续 P1 的需求聚类功能
- 通过 extractionId 可追溯原始上下文

```typescript
/**
 * MVP 数据模型 - 两层结构
 * 存储位置: IndexedDB (Dexie.js)
 */

/**
 * 提取记录 - 记录一次页面分析的上下文
 */
interface Extraction {
  id: string;                    // UUID
  url: string;                   // 来源页面 URL
  title: string;                 // 页面标题
  platform: string;              // 平台标识 (reddit/zhihu/generic)
  originalText: string;          // 原始文本 (脱敏后)
  summary: string;               // AI 生成的页面摘要
  analysisStatus: 'completed' | 'pending' | 'failed';  // 分析状态
  demandCount: number;           // 识别出的需求数量
  savedDemandCount: number;      // 用户保存的需求数量
  capturedAt: Date;              // 捕获时间
  createdAt: Date;
  updatedAt: Date;
}

/**
 * 需求 - 核心实体，最小管理单元
 */
interface Demand {
  id: string;                    // UUID
  extractionId: string;          // 关联的提取记录 ID

  // 需求内容
  description: string;           // 需求描述 (一句话概括)
  painLevel: number;             // 痛点强度 1-10
  frequency: number;             // 出现频率 1-10
  payWillingness: number;        // 付费意愿 1-10
  category: string;              // 需求分类
  evidence: string[];            // 原文证据摘录 (脱敏后)

  // 来源快照 (冗余存储，便于列表展示)
  sourceUrl: string;             // 来源 URL
  sourceTitle: string;           // 来源标题
  sourcePlatform: string;        // 来源平台

  // 用户管理字段
  tags: string[];                // 用户标签
  starred: boolean;              // 是否收藏
  archived: boolean;             // 是否归档
  notes: string;                 // 用户笔记

  // [P1 未来字段 - MVP 阶段不实现]
  // clusterId: string;          // 聚类分组 ID [P1]
  // similarDemandIds: string[]; // 相似需求 ID [P1]

  createdAt: Date;
  updatedAt: Date;
}

/**
 * Chrome Storage Sync 备份结构
 * 用途: 跨设备恢复入口索引
 * 限制: 总大小 ≤ 100KB
 * 说明: 仅备份需求索引，不备份提取记录
 */
interface SyncBackupIndex {
  version: number;
  lastBackupAt: Date;
  demands: Array<{
    id: string;
    extractionId: string;
    description: string;         // 截断至 50 字符
    sourceUrl: string;
    tags: string[];
    starred: boolean;
    createdAt: Date;
  }>;
}
```

**存储策略**：

| 数据 | 存储位置 | 说明 |
|-----|---------|------|
| Extraction | IndexedDB | 完整提取记录，支持离线 |
| Demand | IndexedDB | 完整需求数据，支持离线 |
| SyncBackupIndex | Chrome Storage Sync | 仅需求索引，≤100KB，用于跨设备恢复入口 |

**索引设计**：

```typescript
// Dexie.js 索引配置
db.version(1).stores({
  extractions: 'id, url, platform, capturedAt',
  demands: 'id, extractionId, *tags, starred, archived, createdAt, [starred+createdAt]'
});
```

### 4.4 Side Panel UI 规范

#### 页面结构

Side Panel 包含以下主要视图：

```
┌─────────────────────────────────────────┐
│              Side Panel                  │
├─────────────────────────────────────────┤
│  ┌─────────┐  ┌─────────┐  ┌─────────┐ │
│  │ 分析视图 │  │ 需求库  │  │  设置   │ │
│  │ (默认)  │  │         │  │         │ │
│  └─────────┘  └─────────┘  └─────────┘ │
└─────────────────────────────────────────┘
```

#### 视图1：分析视图（当前页面分析）

```
┌─────────────────────────────────────────┐
│ Demand Radar           [需求库] [⚙️]    │
├─────────────────────────────────────────┤
│ 📄 当前页面                              │
│ ┌─────────────────────────────────────┐ │
│ │ r/SaaS - Why is there no good...   │ │
│ │ reddit.com · 可分析                 │ │
│ └─────────────────────────────────────┘ │
│                                         │
│       ┌─────────────────────┐          │
│       │   🔍 分析此页面     │          │
│       └─────────────────────┘          │
├─────────────────────────────────────────┤
│ 📊 分析结果                    [骨架屏] │
│ ─────────────────────────────────────── │
│ 📋 摘要                                 │
│ ┌─────────────────────────────────────┐ │
│ │ 用户讨论现有 PDF 工具的痛点，主要   │ │
│ │ 集中在价格、功能臃肿、批量处理...   │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 💡 识别到 3 个需求                      │
│ ─────────────────────────────────────── │
│ ┌─────────────────────────────────────┐ │
│ │ ☑️ 需求 1                    [展开] │ │
│ │ 轻量级 PDF 批量处理工具             │ │
│ │ 痛点 ████████░░ 8  付费 ███████░░░ 7│ │
│ └─────────────────────────────────────┘ │
│ ┌─────────────────────────────────────┐ │
│ │ ☐ 需求 2                    [展开] │ │
│ │ 本地优先的隐私方案                  │ │
│ │ 痛点 ██████░░░░ 6  付费 ████░░░░░░ 4│ │
│ └─────────────────────────────────────┘ │
│ ┌─────────────────────────────────────┐ │
│ │ ☑️ 需求 3                    [展开] │ │
│ │ 一次性付费而非订阅                  │ │
│ │ 痛点 ███████░░░ 7  付费 ████████░░ 8│ │
│ └─────────────────────────────────────┘ │
│                                         │
├─────────────────────────────────────────┤
│        [💾 保存选中的 2 个需求]         │
└─────────────────────────────────────────┘
```

#### 视图2：需求详情（展开状态）

```
┌─────────────────────────────────────────┐
│ ← 返回                      ⭐ 📤 ⋮     │
├─────────────────────────────────────────┤
│ 🔗 来源                                 │
│ r/SaaS · reddit.com · 2小时前           │
│ "Why is there no good tool for..."      │
│ [打开原文 ↗]                            │
├─────────────────────────────────────────┤
│                                         │
│ 💡 需求描述                             │
│ ┌─────────────────────────────────────┐ │
│ │ 轻量级 PDF 批量处理工具              │ │
│ │ 用户需要一个简单的工具来批量合并、   │ │
│ │ 拆分 PDF，而非功能臃肿的专业软件     │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 📊 评分                                 │
│ ┌─────────────────────────────────────┐ │
│ │ 痛点强度  ████████░░ 8/10           │ │
│ │ 出现频率  ██████░░░░ 6/10           │ │
│ │ 付费意愿  ███████░░░ 7/10           │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 📂 分类                                 │
│ [效率工具] [B2B SaaS]                   │
│                                         │
│ 📝 证据原文                             │
│ ┌─────────────────────────────────────┐ │
│ │ "I just need to merge 50 PDFs but  │ │
│ │  every tool wants $20/mo for that" │ │
│ ├─────────────────────────────────────┤ │
│ │ "Adobe is overkill for my needs,   │ │
│ │  I'd happily pay for simpler"      │ │
│ └─────────────────────────────────────┘ │
│                                         │
├─────────────────────────────────────────┤
│ 🏷️ 我的标签                            │
│ [+ SaaS创意] [+ 待验证] [+ 添加]        │
├─────────────────────────────────────────┤
│ 📝 我的笔记                             │
│ ┌─────────────────────────────────────┐ │
│ │ 可以用 WebAssembly 做纯前端方案，   │ │
│ │ 主打隐私和一次性付费...             │ │
│ │                            [保存]  │ │
│ └─────────────────────────────────────┘ │
├─────────────────────────────────────────┤
│ [🗑️ 删除]              [📥 保存到需求库]│
└─────────────────────────────────────────┘
```

#### 视图3：需求库列表

```
┌─────────────────────────────────────────┐
│ ← 返回分析               需求库    [⚙️] │
├─────────────────────────────────────────┤
│ 🔍 搜索需求...                          │
├─────────────────────────────────────────┤
│ 筛选: [全部▾] [标签▾] [⭐收藏] [📁归档] │
├─────────────────────────────────────────┤
│                                         │
│ ⭐ 轻量级 PDF 批量工具                  │
│    痛点 8/10 · r/SaaS · 2小时前         │
│    [SaaS创意] [待验证]                  │
│ ─────────────────────────────────────── │
│    一次性付费模式                       │
│    痛点 7/10 · r/SaaS · 2小时前         │
│    [SaaS创意]                           │
│ ─────────────────────────────────────── │
│ ⭐ 本地化翻译工具需求                   │
│    痛点 7/10 · 知乎 · 昨天              │
│    [工具] [已验证]                      │
│ ─────────────────────────────────────── │
│    ... 更多需求                         │
│                                         │
├─────────────────────────────────────────┤
│ 共 24 个需求 · 5 个收藏                 │
└─────────────────────────────────────────┘
```

#### 交互规范

| 交互 | 行为 | 说明 |
|-----|------|------|
| 点击扩展图标 | 打开/关闭 Side Panel | 切换显示状态 |
| 点击「分析此页面」 | 提取内容 + LLM 分析 | 显示骨架屏，完成后渲染结果 |
| 勾选需求 | 选中/取消选中 | 控制哪些需求被保存 |
| 点击「保存选中」 | 保存到 IndexedDB | 仅保存勾选的需求 |
| 点击需求卡片 | 展开详情 | 显示完整信息和操作 |
| 点击 ⭐ | 切换收藏状态 | 收藏的需求优先显示 |
| 点击「打开原文」 | 新标签页打开来源 | 验证上下文 |
| 搜索输入 | 实时筛选 | 防抖 300ms |

#### 加载状态

```
分析中状态（骨架屏）:
┌─────────────────────────────────────────┐
│ 📊 分析中...                            │
│ ████████████░░░░░░░░ 60%               │
│ ─────────────────────────────────────── │
│ ┌─────────────────────────────────────┐ │
│ │ ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ │ │
│ │ ░░░░░░░░░░░░░░░░░                   │ │
│ └─────────────────────────────────────┘ │
│ ┌─────────────────────────────────────┐ │
│ │ ░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░ │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘

错误状态:
┌─────────────────────────────────────────┐
│ ⚠️ 分析失败                             │
│ API 配额已用尽，请检查您的 API Key       │
│ ┌─────────────────────────────────────┐ │
│ │ 已保存原文，待后续分析               │ │
│ └─────────────────────────────────────┘ │
│ [重试] [查看原文]                       │
└─────────────────────────────────────────┘
```

---

## 五、隐私与数据合规

### 5.1 数据最小化原则

| 原则 | 实施方式 |
|-----|---------|
| **按需采集** | 仅在用户主动触发时提取页面内容，不后台自动采集 |
| **最小上下文** | 发送给 LLM 的内容经过裁剪，仅保留分析必需的文本 |
| **本地优先** | 所有数据默认存储在本地 IndexedDB，不强制上传 |
| **用户可控** | 用户可随时查看、导出、删除所有存储的数据 |

### 5.2 站点白名单/黑名单

```typescript
interface SiteFilterConfig {
  mode: 'whitelist' | 'blacklist' | 'all';
  whitelist: string[];  // 仅在这些站点启用 (如 ['reddit.com', 'zhihu.com'])
  blacklist: string[];  // 在这些站点禁用 (如 ['mail.google.com', 'bank.*'])
}
```

**默认黑名单** (内置，用户可修改)：
- `*://*.bank.*/*`
- `*://mail.*/*`
- `*://*.gov.*/*`
- `*://*/login*`
- `*://*/account*`

### 5.3 敏感信息过滤

**PII (个人身份信息) 过滤规则**：

| 类型 | 检测模式 | 处理方式 |
|-----|---------|---------|
| 邮箱 | `[\w.-]+@[\w.-]+\.\w+` | 替换为 `[EMAIL]` |
| 电话 | `1[3-9]\d{9}` / `\d{3}-\d{4}-\d{4}` | 替换为 `[PHONE]` |
| 身份证 | `\d{17}[\dXx]` | 替换为 `[ID]` |
| 信用卡 | `\d{4}[\s-]?\d{4}[\s-]?\d{4}[\s-]?\d{4}` | 替换为 `[CARD]` |
| IP 地址 | `\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}` | 替换为 `[IP]` |

**LLM 传输脱敏**：
- 发送前执行 PII 过滤
- 限制单次传输文本长度 ≤ 8000 tokens
- 不传输页面 cookies、localStorage 等敏感数据

### 5.4 用户数据权利

| 权利 | 实现方式 |
|-----|---------|
| **查看权** | 设置页 → 数据管理 → 查看所有存储数据 |
| **导出权** | 一键导出为 JSON/CSV，包含所有用户数据 |
| **删除权** | 单条删除 / 批量删除 / 一键清空所有数据 |
| **离线处理** | 无网络时默认本地处理，不尝试外传 |

### 5.5 LLM 调用安全

- API Key 使用 `crypto.subtle` 加密存储，不明文保存
- 调用日志仅记录时间戳和 token 用量，不记录内容
- 支持设置每日/每月调用次数上限
- 支持设置费用预警阈值

---

## 六、非功能需求

### 6.1 分场景性能指标

#### 场景分类与时间阈值

| 场景 | 内容规模 | 提取时间 | LLM分析时间 | 总时间阈值 | 降级策略 |
|-----|---------|---------|-----------|-----------|---------|
| **单页文章** | < 3000 字 | < 1s | < 5s | **< 6s** | - |
| **长帖子** | 3000-10000 字 | < 2s | < 8s | **< 10s** | >8s 显示"后台继续分析"通知 |
| **多评论页** | > 50 条评论 | < 3s | < 10s | **< 13s** | >8s 显示进度条 + 托盘通知 |
| **超长内容** | > 10000 字 | < 3s | - | - | 提示"内容过长，已截取前8000字" |

#### 降级与失败处理

| 情况 | 处理方式 | 用户提示 |
|-----|---------|---------|
| 提取超时 (>5s) | 返回已提取内容 | "部分内容提取完成" |
| LLM 超时 (>15s) | 存储原文，标记待分析 | "内容已保存，后台继续分析" + 托盘通知 |
| LLM 失败 | 仅存储原文和基础摘要 | "AI 分析暂不可用，已保存原文" |
| 网络离线 | 本地 Readability 摘要 | "离线模式：已生成基础摘要" |

#### 内存与资源占用

| 指标 | 目标值 | 说明 |
|-----|-------|------|
| 常驻内存 | **< 80MB** | Background Service Worker 常驻 |
| 峰值内存 | **< 150MB** | 分析大页面时的峰值 |
| CPU 占用 | < 5% (空闲) | 无操作时 |

**UI 组件加载策略**：
- Side Panel 作为主界面，提供完整功能
- 需求列表采用虚拟滚动，单次渲染 ≤ 20 条
- 图片/富文本预览延迟加载

### 6.2 兼容性要求

| 平台 | 要求 | 备注 |
|-----|------|------|
| Chrome | v100+ | MVP 主要平台 |
| Edge | v100+ | 兼容测试 |
| Firefox | v100+ | P1 适配 |
| Safari | 暂不支持 | MV3 兼容性问题 |

### 6.3 安全要求

#### 权限最小化

```json
// manifest.json 权限声明
{
  "permissions": [
    "activeTab",      // 仅当前激活标签页
    "storage",        // 本地存储
    "scripting"       // 动态注入内容脚本
  ],
  "host_permissions": [
    // MVP 阶段不申请 <all_urls>，按需在特定站点激活
  ]
}
```

**不申请的权限**：
- `tabs` - 不需要访问所有标签页
- `history` - 不需要浏览历史
- `bookmarks` - 不需要书签
- `webRequest` - 不需要拦截请求

#### 内容脚本安全

| 措施 | 说明 |
|-----|------|
| **脚本隔离** | Content Script 运行在隔离环境，不与页面脚本共享作用域 |
| **XSS 防护** | 使用 DOMPurify 清理提取的 HTML 内容 |
| **CSP 遵守** | 不使用 `eval()`、内联脚本等违反 CSP 的代码 |
| **消息验证** | Runtime 消息通信验证 sender.id |

#### API Key 安全

| 措施 | 实现方式 |
|-----|---------|
| **加密存储** | 使用 `crypto.subtle.encrypt` (AES-GCM) 加密后存入 storage |
| **内存保护** | 使用后立即清除内存中的明文 Key |
| **调用速率限制** | 默认 60 次/小时，用户可调整 |
| **费用上限提示** | 设置月度费用预警 (默认 $5)，达到阈值时弹窗提醒 |

#### LLM 失败降级

```
LLM 调用失败
    │
    ├─► 网络错误 → 重试 1 次 → 仍失败 → 离线模式 (Readability 摘要)
    │
    ├─► API 额度耗尽 → 提示用户检查额度 → 仅存储原文
    │
    ├─► 超时 → 后台继续 (60s) → 仍超时 → 存储原文，标记待分析
    │
    └─► 其他错误 → 记录日志 → 存储原文，显示错误信息
```

---

## 七、MVP 定义

### 7.1 MVP 范围

**包含**：
- [x] 一键提取当前页面内容 (Reddit/知乎/通用网页)
- [x] LLM 需求分析（用户自备 API Key）
- [x] 需求评分展示 (痛点强度/频率/付费意愿)
- [x] 本地存储需求列表 (IndexedDB)
- [x] 轻量元数据备份 (Chrome Storage Sync)
- [x] 基础搜索和标签筛选
- [x] Side Panel 界面
- [x] 站点黑名单/白名单
- [x] PII 脱敏过滤
- [x] LLM 离线降级

**不包含**：
- [ ] 云端同步服务器 → P1
- [ ] 账户系统 → P1
- [ ] 批量分析 → P1
- [ ] 需求聚类 → P1
- [ ] Popup 快捷入口 → P1
- [ ] Twitter/X 深度适配 → P1
- [ ] 社区功能 → P2

### 7.2 成功指标与埋点

#### 北极星指标

| 指标 | 目标值 | 定义 |
|-----|-------|------|
| **周活跃留存** | ≥ 35% | 第 N 周活跃用户在 N+1 周仍活跃的比例 |
| **首次提取→保存转化** | ≥ 40% | 完成首次提取的用户中，保存至少 1 条需求的比例 |

#### 核心指标

| 指标 | 目标值 | 衡量方式 |
|-----|-------|---------|
| 安装量 | 500+ | Chrome 商店数据 |
| 周活跃用户 (WAU) | 100+ | 插件埋点 |
| 单用户周均使用次数 | 5+ | 插件埋点 |
| 用户满意度 | 4.0+ 星 | Chrome 商店评分 |
| **API Key 配置完成率** | ≥ 70% | 安装后 7 天内完成配置的用户比例 |

#### 埋点事件表

| 事件名 | 触发时机 | 关键参数 | 用途 |
|-------|---------|---------|------|
| `install` | 插件安装完成 | install_source, browser_version | 获客渠道分析 |
| `enable` | 插件启用 | - | 活跃度 |
| `first_extract` | 首次提取内容 | platform, content_length | 激活转化 |
| `extract` | 每次提取 | platform, content_length, duration_ms | 功能使用 |
| `analyze_complete` | LLM 分析完成 | demand_count, duration_ms, status | 核心功能质量 |
| `analyze_fail` | LLM 分析失败 | error_type, fallback_action | 错误监控 |
| `save_demand` | 保存需求 | demand_count, has_tags | 核心转化 |
| `search` | 搜索需求库 | query_length, result_count | 功能使用 |
| `delete_demand` | 删除需求 | - | 用户行为 |
| `config_apikey` | 配置 API Key | provider (openai/claude) | 配置完成率 |
| `revisit_day7` | 安装后第 7 天回访 | total_demands_saved | 留存 |

**隐私说明**：
- 所有埋点数据匿名化，不包含用户身份信息
- 不上报页面 URL、提取内容、分析结果等敏感数据
- 用户可在设置中关闭数据收集

---

## 八、技术选型建议

### 8.1 插件框架

| 选项 | 优点 | 缺点 | 推荐度 |
|-----|-----|------|-------|
| **Plasmo** | 现代化、React 支持、HMR | 学习曲线 | ⭐⭐⭐⭐⭐ |
| **WXT** | 轻量、多浏览器支持 | 社区较小 | ⭐⭐⭐⭐ |
| 原生开发 | 无依赖 | 开发效率低 | ⭐⭐ |

### 8.2 技术栈推荐

```
框架: Plasmo
UI: React + Tailwind CSS
状态管理: Zustand
本地存储: IndexedDB (Dexie.js)
内容提取: @mozilla/readability + Turndown
HTML清理: DOMPurify
加密: Web Crypto API (crypto.subtle)
LLM: OpenAI API / Claude API (用户自备 Key)
埋点: 自建简易方案 / Mixpanel (P1)
同步 (P1): Supabase / Firebase
```

---

## 九、迭代路线图

### Phase 1 - MVP (5 周 + 1 周缓冲)

```
Week 1: 提取稳定性
├── 目标: Reddit/知乎 提取器稳定可用
├── 里程碑: 两个平台各 30 条页面测试通过率 ≥ 90%
├── 角色: 1 前端开发
└── 产出: Content Script + 平台适配器

Week 2: UI 骨架
├── 目标: Popup 界面基本可用
├── 里程碑: 能展示提取结果，支持基础交互
├── 角色: 1 前端开发
└── 产出: Popup 组件 + 设置页面

Week 3: LLM 接入 + 缓存
├── 目标: LLM 分析流程完整
├── 里程碑: 需求识别 Top3 命中率 ≥ 70% (20 条样本)
├── 角色: 1 前端开发
└── 产出: LLM 服务 + IndexedDB 存储 + 离线降级

Week 4: 安全 + 打磨
├── 目标: 安全机制完备，体验打磨
├── 里程碑: PII 过滤、API Key 加密、黑名单功能完成
├── 角色: 1 前端开发
└── 产出: 安全模块 + 埋点接入

Week 5: 测试 + 上架准备
├── 目标: 提交 Chrome 商店审核
├── 里程碑: 通过内部测试，准备商店素材
├── 角色: 1 前端开发 + 产品
└── 产出: 测试报告 + 商店页面 + 隐私政策

Week 6: 缓冲周
├── 用途: 应对平台变更、审核反馈、紧急 Bug
└── 如无问题则用于: P1 功能预研
```

### Phase 2 - 增强 (4-6 周)

```
├── 云端同步 + 账户系统 (见 附录E)
├── 高级分析功能 (批量分析、需求聚类)
├── Twitter/X 适配
├── 侧边栏视图
└── 多平台适配优化
```

### Phase 3 - 扩展 (持续)

```
├── 需求社区
├── 团队协作
└── AI 深度功能 (PRD生成、竞品关联)
```

---

## 十、风险与应对

| 风险 | 影响 | 概率 | 应对措施 |
|-----|-----|-----|---------|
| LLM API 成本过高 | 用户流失 | 中 | 支持多种模型、提供用量预估、费用预警机制 |
| 页面结构变化导致提取失败 | 功能不可用 | 高 | 平台适配器架构 + 回退策略 + 快速响应更新 (缓冲周) |
| 用户隐私担忧 | 口碑下降 | 中 | 透明的隐私政策、本地优先、PII 过滤、权限最小化 |
| 竞品快速跟进 | 市场份额 | 中 | 快速迭代、建立数据网络效应 |
| API Key 泄露 | 用户财产损失 | 低 | 加密存储、内存保护、使用指引 |
| Chrome 商店审核被拒 | 上线延期 | 中 | 预留缓冲周、提前研究审核政策、准备申诉材料 |

---

## 十一、附录

### A. 竞品分析

| 竞品 | 定位 | 差异点 |
|-----|-----|-------|
| Glasp | 网页高亮笔记 | 我们聚焦需求挖掘，非通用笔记 |
| Notion Web Clipper | 内容收藏 | 我们提供智能分析，非简单存储 |
| ChatGPT 插件 | 通用 AI 助手 | 我们专注需求场景，体验更垂直 |

### B. 参考资料

- Chrome Extension Manifest V3 文档
- Plasmo 官方文档
- OpenAI API 文档
- Chrome Web Store 开发者政策

### C. Chrome 扩展数据声明与权限列表

#### 权限声明 (manifest.json)

```json
{
  "manifest_version": 3,
  "name": "Demand Radar",
  "version": "1.0.0",
  "permissions": [
    "activeTab",
    "storage",
    "scripting"
  ],
  "host_permissions": [],
  "content_scripts": [
    {
      "matches": ["*://*.reddit.com/*", "*://*.zhihu.com/*"],
      "js": ["content.js"],
      "run_at": "document_idle"
    }
  ]
}
```

#### Chrome Web Store 数据披露

| 披露项 | 声明内容 |
|-------|---------|
| **数据收集** | 收集用户主动提取的网页内容用于分析 |
| **数据使用** | 本地存储 + 发送至用户配置的 LLM API 进行分析 |
| **数据共享** | 不与第三方共享用户数据（LLM API 除外，用户自行配置） |
| **数据存储** | 主要存储在本地 IndexedDB，元数据备份至 Chrome Storage Sync |
| **数据删除** | 用户可随时删除所有数据 |

#### 隐私政策要点

1. 我们仅在用户主动触发时提取页面内容
2. 提取的内容经过 PII 脱敏后发送至用户配置的 LLM 服务
3. 所有数据默认存储在用户本地设备
4. 我们不运营任何服务器存储用户数据 (MVP 阶段)
5. 用户可随时导出或删除所有数据

### D. 验收测试集规范

#### 正文识别测试集

| 平台 | 样本数 | 样本类型 | 标注内容 |
|-----|-------|---------|---------|
| Reddit | 30+ | 帖子正文 | 预期提取的正文边界 |
| 知乎 | 30+ | 问答内容 | 预期提取的问题+回答 |
| 通用 | 20+ | 博客/新闻 | 预期提取的文章正文 |

#### 准确率/召回率计算

```
准确率 = 正确提取的字符数 / 实际提取的总字符数
召回率 = 正确提取的字符数 / 应该提取的总字符数

判定标准:
- 正确: 提取内容与人工标注重叠度 ≥ 80%
- 遗漏: 应提取内容未被提取
- 噪音: 不应提取的内容被提取 (广告、导航等)
```

#### LLM 需求识别测试

| 指标 | 计算方式 | 目标 |
|-----|---------|------|
| Top3 命中率 | LLM 输出的 Top3 需求中至少 1 个与人工标注匹配 | ≥ 70% |
| 匹配定义 | 语义相似度 ≥ 0.7 或人工判定"表达同一需求" | - |
| 样本量 | 100 条人工标注样本 | - |

### E. P1 同步方案 (Phase 2)

> 本节内容在 Phase 2 实现，MVP 阶段不适用

#### 同步架构

```
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│   设备 A     │     │   云端服务    │     │   设备 B     │
│  (Chrome)    │────▶│  (Supabase)  │◀────│  (Edge)      │
└──────────────┘     └──────────────┘     └──────────────┘
       │                    │                    │
       ▼                    ▼                    ▼
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│ IndexedDB    │     │  PostgreSQL  │     │ IndexedDB    │
│ (本地缓存)   │     │  (主数据库)   │     │ (本地缓存)   │
└──────────────┘     └──────────────┘     └──────────────┘
```

#### P1 数据模型扩展

```typescript
interface DemandItem {
  // ... MVP 字段 ...

  // P1 同步字段
  sync: {
    localVersion: number;        // 本地版本号
    serverVersion: number;       // 服务器版本号
    lastSyncedAt: Date;          // 最后同步时间
    status: 'synced' | 'pending' | 'conflict';
  };
}
```

#### 同步策略

| 策略 | 描述 | 适用场景 |
|-----|------|---------|
| **本地优先** | 所有操作先写入本地，后台异步同步 | 保证离线可用 |
| **增量同步** | 只同步变更数据，非全量覆盖 | 节省带宽 |
| **冲突解决** | 以最后修改时间为准，保留两个版本 | 多设备编辑 |
| **实时推送** | WebSocket 推送其他设备的变更 | 在线状态 |

---

## 变更记录

| 版本 | 日期 | 变更内容 | 作者 |
|-----|-----|---------|-----|
| 1.0 | 2025-12-08 | 初稿创建 | - |
| 1.1 | 2025-12-08 | MVP数据策略澄清；隐私合规补充；验收标准细化；分场景性能指标；埋点事件表；平台适配器；安全配额控制；路线图资源对齐 | - |
| 1.2 | 2025-12-08 | UI架构从Popup改为Side Panel；数据模型改为两层结构（Extraction + Demand）；以单个需求为最小管理单元；新增 Side Panel UI 规范（4.4节） | - |

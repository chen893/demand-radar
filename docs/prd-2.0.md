# Demand Radar - 产品需求文档 (PRD)

> 版本: 2.0
> 更新日期: 2025-12-09
> 产品负责人: [待定]
> 文档状态: 重构版

---

## 一、产品概述

### 1.1 产品定位

**Demand Radar（需求雷达）** 是一款浏览器插件，帮助用户从日常浏览的网页内容中**提炼可执行的产品解决方案**。

**一句话描述**：把用户吐槽，变成可落地的产品方向。

**核心认知转变**：

| 传统思路 | Demand Radar 思路 |
|---------|------------------|
| 记录「用户在抱怨什么」 | 提炼「可以做什么产品」 |
| 给痛点打分 (8/10) | 输出产品方向 + 核心差异点 |
| 收集需求信号 | 提炼解决方案 |
| LLM 判断需求价值 | LLM 提炼方向，**人来判断价值** |

### 1.2 产品背景

**问题洞察**：
- 产品经理、创业者、独立开发者每天浏览大量网页，其中蕴含丰富的需求信号
- 这些信号散落在 Reddit 吐槽帖、知乎问答、Twitter 讨论中，容易被遗忘
- 用户很少直接说「我愿意付 $50」，而是说「现有工具解决不了我的问题」
- **关键洞察**：LLM 无法凭空判断「痛点强度 8/10」是否准确，但可以从用户吐槽中**提炼出可能的产品方向**

**解决方案**：
- 通过浏览器插件无缝融入用户日常工作流
- 利用 LLM 从用户吐槽中**提炼解决方案方向**，而非简单打分
- 本地优先存储，构建个人产品创意库
- 最终决策权交给人，LLM 只做「提炼」不做「判断」

### 1.3 核心价值主张

#### 1.3.1 LLM 与人的分工

| LLM 负责 | 人负责 |
|---------|-------|
| 从吐槽中提炼「产品方向」 | 判断这个方向是否值得做 |
| 总结核心差异点 | 补充自己的想法和见解 |
| 整理竞品及其不足 | 深入调研验证市场 |
| 提取原文证据 | 最终决策是否执行 |

#### 1.3.2 核心输出结构

每次分析输出的不是「痛点评分」，而是：

```
┌─────────────────────────────────────────┐
│ 💡 产品方向                              │
│ ┌─────────────────────────────────────┐ │
│ │ 标题：本地 PDF 批量处理工具           │ │
│ │ 描述：一款本地运行、一次买断的轻量     │ │
│ │      工具，专注批量合并/拆分/压缩     │ │
│ │ 目标用户：需要频繁处理 PDF 的办公人员  │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ ✨ 核心差异点                            │
│ • 本地运行，保护隐私                     │
│ • 一次买断，无订阅                       │
│ • 专注批量操作，不做复杂编辑             │
│                                         │
│ 📊 验证依据                              │
│ ┌─────────────────────────────────────┐ │
│ │ 痛点：现有工具太贵/担心隐私/太复杂    │ │
│ │ 竞品：Adobe Acrobat, Smallpdf       │ │
│ │ 竞品不足：订阅制/要上传云端/功能臃肿  │ │
│ │ 原文证据：[3条用户原话]              │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

### 1.4 与竞品的差异化

| 差异点 | 实现方式 | 用户价值 |
|-------|---------|---------|
| **无缝嵌入工作流** | 浏览器原生 Side Panel，无需切换上下文 | 降低使用摩擦，提高捕获率 |
| **结构化积累** | Demand 实体 + 标签 + 时间线 | ChatGPT 对话会丢失，这里永久保存 |
| **来源可追溯** | 保存原文 URL + 证据摘录 | 方便后续深入研究和验证 |
| **解决方案导向** | 输出产品方向而非痛点评分 | 更接近用户真正需要的决策信息 |

**与 ChatGPT 的关系**：互补而非竞争
- Demand Radar 专注「快速捕获 + 结构化积累」
- 需求卡片可「一键在 ChatGPT 深入分析」（承认 ChatGPT 的强大）
- ChatGPT 是通用工具，Demand Radar 是垂直场景的专业工具

### 1.5 产品愿景

成为专业人士发现产品机会的第一入口，让每个人都能从用户声音中**提炼出可执行的产品方向**。

---

## 二、目标用户与平台策略

### 2.1 核心用户画像

| 用户类型 | 特征描述 | 核心诉求 | 使用频率 | 主要平台 |
|---------|---------|---------|---------|---------|
| **独立开发者** | 寻找 Side Project 方向，关注 Indie Hackers/Reddit | 发现可执行的产品创意 | 高频 | Reddit, HN |
| **产品经理** | 负责竞品分析和用户研究 | 高效捕捉用户痛点 | 高频 | 知乎, Reddit |
| **创业者** | 寻找创业方向或验证想法 | 系统化的机会发现 | 中频 | Reddit, Twitter |
| **投资人/分析师** | 研究行业趋势和投资标的 | 比市场更早发现信号 | 中频 | 多平台 |

### 2.2 用户优先级

**P0 (MVP 核心用户)**: 独立开发者、产品经理
- 共同特征：主动寻找产品机会，愿意使用工具提高效率
- 关键行为：频繁浏览 Reddit/知乎 的吐槽帖和讨论

**P1 (扩展用户)**: 创业者、内容创作者
**P2 (未来用户)**: 投资人、企业战略部门

### 2.3 平台适配策略

#### 2.3.1 MVP 平台优先级调整

| 平台 | 原优先级 | **新优先级** | 调整理由 |
|-----|---------|-------------|---------|
| **知乎** | P0 | **P0** | 中国用户主要平台，问答结构清晰 |
| **Reddit** | P1 | **P0** | 需求信号密度高，DOM 结构稳定，核心用户主战场 |
| 通用网页 | P0 按需 | **P0 按需** | 保持不变，需用户授权 |
| Twitter/X | P1 | P1 | 受平台限制，仅支持公开内容 |
| Hacker News | P1 | P1 | 评论树结构化提取 |

**决策理由**：
- 独立开发者（P0 用户）的主战场是 Reddit，而非知乎
- Reddit 需求信号密度高：r/SaaS、r/Entrepreneur、r/startups 充满真实用户吐槽
- Reddit DOM 结构相对稳定，反爬措施少，开发成本可控
- 工作量增加约 1-2 天，但用户-平台匹配度大幅提升

#### 2.3.2 平台适配器表

| 平台 | 优先级 | 解析方案 | 分页/懒加载处理 | 回退策略 |
|-----|-------|---------|---------------|---------|\
| **Reddit** | **P0 MVP** | 专用选择器提取帖子+评论树 | 用户手动展开后一次性提取 | Readability 纯正文 |
| **知乎** | **P0 MVP** | 专用选择器提取问答内容 | 仅提取已展开内容（提示点击「查看全部」） | Readability 纯正文 |
| 通用网页 | P0 按需 | @mozilla/readability | 不处理 | document.body.innerText |
| Twitter/X | P1 受限 | 时间线公开内容提取 | 仅首屏可见内容 | 提示用户手动复制 |
| Hacker News | P1 | 评论树结构化提取 | 解析页面现有评论树 | 纯文本提取 |

> **说明**：MVP 默认白名单模式，安装引导推荐勾选知乎和 Reddit；通用网页需用户授予域名权限后再注入。分页/懒加载不监听、不自动触发 LLM，点击「分析」时一次性抓取当前已加载内容。

### 2.4 平台内容价值分类

不同平台、不同类型的内容，需求信号强度不同。以下是人工判断参考（LLM 会根据内容自动提炼解决方案）：

#### 2.4.1 Reddit 内容价值

| 内容类型 | 典型特征 | 需求信号 | 示例 |
|---------|---------|---------|------|
| 吐槽帖 | 「Why is there no...」「I hate that...」 | **高** | 「Why is there no simple PDF merger?」 |
| 求推荐帖 | 「Looking for...」「Any alternatives to...」 | **高** | 「Looking for a local-first note app」 |
| Show HN 类 | 展示自己的项目 | 中 | 可分析评论中的用户反馈 |
| 讨论帖 | 行业趋势、观点交流 | 低 | 信号分散，不易提炼 |

**高价值 Subreddit**：
- r/SaaS, r/Entrepreneur, r/startups - 创业/产品讨论
- r/selfhosted - 本地化/隐私需求
- r/productivity, r/GetMotivated - 效率工具需求

#### 2.4.2 知乎内容价值

| 内容类型 | 典型特征 | 需求信号 | 处理策略 |
|---------|---------|---------|---------|
| 「为什么 XX 这么难用」 | 抱怨现有工具 | **高** | 提取痛点，标记为「待验证需求」 |
| 「如何解决 XX 问题」 | 寻求解决方案 | **中** | 提取问题场景 |
| 「有哪些好用的 XX 工具」 | 工具推荐 | **低** | 提取「用户在用什么」，标记为「竞品情报」 |
| 专业领域深度回答 | 行业分析 | 低 | 信息密度高但需求信号弱 |

---

## 三、用户场景与旅程

### 3.1 MVP 核心场景

#### 场景 1：Reddit 吐槽帖分析 (P0 核心)

> **用户**：独立开发者小李
> **场景**：浏览 r/SaaS 时看到一个吐槽帖「Why is there no simple tool to merge PDFs without uploading to cloud?」
> **行为**：点击插件图标，打开 Side Panel，点击「分析此页面」
> **结果**：
> - LLM 提炼出产品方向：「本地 PDF 批量处理工具」
> - 核心差异点：本地运行、一次买断、专注批量操作
> - 竞品不足：Adobe 太贵、Smallpdf 要上传云端
> - 原文证据：3 条用户原话
> **价值**：小李保存该方向到需求库，一周后发现类似方向出现 5 次，决定深入调研

#### 场景 2：知乎问答分析 (P0 核心)

> **用户**：产品经理小王
> **场景**：浏览知乎「为什么国内没有好用的项目管理工具」问题下的高赞回答
> **行为**：点击插件，分析当前页面
> **结果**：
> - LLM 提炼出 2 个产品方向
> - 方向 1：轻量级个人任务管理（差异点：不要团队协作功能）
> - 方向 2：本土化的项目管理（差异点：符合国内工作习惯）
> **价值**：为产品规划提供用户真实诉求的依据

#### 场景 3：快速捕获模式 (P0 轻量)

> **用户**：创业者老张
> **场景**：快速浏览多个页面，暂时不想花 API 费用
> **行为**：点击「快速保存」（不调用 LLM）
> **结果**：
> - 保存原文 + Readability 生成的基础摘要
> - 标记为「待分析」状态
> - 后续可批量分析或单独分析
> **价值**：零成本积累原始素材，降低使用门槛

### 3.2 P1 扩展场景

#### 场景 4：需求去重分析

> **用户**：独立开发者小李
> **场景**：积累了 50 个需求，想看看有没有重复出现的方向
> **行为**：打开需求库，点击「分析重复需求」
> **结果**：
> - LLM 分析整个库，返回 3 组相似需求
> - 「PDF 工具需求」(5 条)、「笔记工具需求」(3 条)
> - 用户确认后合并为分组
> **价值**：发现反复出现的需求模式，验证市场信号

#### 场景 5：跨设备需求回顾 (P1)

> **用户**：创业者老张
> **场景**：白天用公司电脑浏览，晚上用个人电脑复盘
> **行为**：打开插件的需求库面板
> **结果**：所有捕捉的需求通过云端同步
> **价值**：系统化积累，不丢失任何发现

### 3.3 用户旅程设计

#### 3.3.1 新用户旅程（简化版）

```
安装插件
    │
    ├─► 欢迎页面：介绍核心价值（30秒）
    │
    ├─► LLM 配置（必选）
    │     ├─► 选择服务商：OpenAI / Google / DeepSeek / 自定义
    │     ├─► 填写 API Key
    │     └─► 测试连接 → 成功
    │
    ├─► 平台选择（可选）
    │     ├─► 推荐勾选：知乎、Reddit
    │     └─► 或跳过，后续按需授权
    │
    └─► 开始使用
          │
          ├─► 打开 Side Panel
          ├─► 浏览目标页面
          └─► 点击「分析此页面」→ 看到第一个解决方案
```

**关键设计**：
- LLM 配置是必选步骤，但支持多服务商降低门槛
- 平台选择可跳过，不阻塞首次使用
- 从安装到看到第一个结果 < 3 分钟

#### 3.3.2 离线/无 API Key 降级旅程

```
用户未配置 API Key / 网络离线
    │
    ├─► 提示：「未配置 LLM，将使用快速保存模式」
    │
    ├─► 点击「快速保存」
    │     ├─► Readability 生成基础摘要
    │     ├─► 保存原文到本地
    │     └─► 标记为「待分析」
    │
    └─► 后续配置 API Key 后
          └─► 可对「待分析」内容重新分析
```

### 3.4 Aha Moment 路径

**目标**：让用户在最短时间内感受到产品价值

| 阶段 | 用户行为 | 产品响应 | 预期时间 |
|-----|---------|---------|---------|
| **首次打开** | 打开 Side Panel | 空状态 + 引导「去 Reddit/知乎 找个吐槽帖试试」 | - |
| **首次分析** | 点击「分析此页面」 | 流式输出：先显示摘要 → 再显示解决方案 | < 10s |
| **首次保存** | 保存 1 个需求 | Toast：「已保存到需求库！」 | - |
| **积累 5 个** | 自动触发 | 提示：「已积累 5 个方向，可以分析重复需求了」 | - |
| **发现重复** | 点击分析重复 | 展示：「发现 2 组相似方向，这个方向被提及 3 次！」 | - |

**Aha Moment 定义**：
- 短期 Aha：看到 LLM 从一篇吐槽帖中提炼出「可以做什么产品」
- 长期 Aha：发现某个产品方向被多次提及，验证了市场信号

### 3.5 空状态与引导设计

#### 3.5.1 Side Panel 空状态

```
┌─────────────────────────────────────────┐
│ Demand Radar              [需求库] [⚙️] │
├─────────────────────────────────────────┤
│                                         │
│           🎯 开始发现产品机会            │
│                                         │
│   浏览 Reddit/知乎 的吐槽帖，            │
│   点击「分析此页面」提炼产品方向          │
│                                         │
│   推荐尝试：                             │
│   • r/SaaS 的 "Why is there no..."      │
│   • 知乎「为什么 XX 这么难用」           │
│                                         │
│   ┌─────────────────────────────────┐   │
│   │     当前页面不在支持列表          │   │
│   │     [授权此站点] 或 [前往 Reddit] │   │
│   └─────────────────────────────────┘   │
│                                         │
└─────────────────────────────────────────┘
```

#### 3.5.2 需求库空状态

```
┌─────────────────────────────────────────┐
│ ← 返回                     需求库  [⚙️] │
├─────────────────────────────────────────┤
│                                         │
│           📦 需求库是空的                │
│                                         │
│   分析页面后，保存感兴趣的产品方向        │
│   这里会成为你的产品创意库                │
│                                         │
│   ┌─────────────────────────────────┐   │
│   │      [去分析第一个页面]          │   │
│   └─────────────────────────────────┘   │
│                                         │
└─────────────────────────────────────────┘
```

---

## 四、功能需求

### 4.1 功能架构

```
┌─────────────────────────────────────────────────────────────┐
│                      Demand Radar                            │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │  内容提取层  │  │  智能分析层  │  │  数据管理层  │         │
│  ├─────────────┤  ├─────────────┤  ├─────────────┤         │
│  │ • 页面文本   │  │ • LLM 分析   │  │ • IndexedDB │         │
│  │ • 评论抓取   │  │ • 解决方案   │  │ • 容量管理   │         │
│  │ • 元数据     │  │   提炼       │  │ • 标签管理   │         │
│  │ • 正文提取   │  │ • 离线降级   │  │ • 搜索过滤   │         │
│  │ • 平台适配   │  │ • 去重分析   │  │ • 导入导出   │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
├─────────────────────────────────────────────────────────────┤
│                        用户界面层                            │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │ Side Panel  │  │  设置页面    │  │  欢迎引导    │         │
│  │  (侧边栏)   │  │             │  │             │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
└─────────────────────────────────────────────────────────────┘
```

### 4.2 功能清单

#### P0 - MVP 必备功能

| 功能模块 | 功能点 | 描述 | 验收标准 |
|---------|-------|------|---------|
| **内容提取** | 一键提取 | 点击插件提取当前页面核心内容 | 见 [7.2 分场景性能指标] |
| | 智能正文识别 | 自动识别文章/帖子正文，过滤噪音 | Reddit/知乎各 30 页测试，准确率≥90%，召回率≥85% |
| | 评论提取 | 提取页面评论/回复内容 | 每站点≥30 帖测试，结构化成功率≥85% |
| | 平台适配器 | Reddit + 知乎专用适配 | 覆盖主流页面类型 |
| **智能分析** | 解决方案提炼 | LLM 从内容中提炼产品方向 | 解决方案质量评分≥3.5/5（见 7.3） |
| | 差异点提取 | 提炼核心差异点（3-5 个） | 每个方向至少 2 个有效差异点 |
| | 竞品分析 | 识别竞品及其不足 | 竞品识别准确率≥70% |
| | 证据摘录 | 提取原文证据 | 每个方向至少 1 条原文支撑 |
| | 摘要生成 | 生成页面内容摘要 | 摘要长度 100-200 字 |
| | 离线降级 | LLM 不可用时的降级处理 | 存储原文+基础摘要，标记「待分析」 |
| | 快速保存 | 不调用 LLM，仅保存原文 | 零 API 成本积累 |
| **数据管理** | 本地存储 | IndexedDB 持久化存储 | 单条≤500KB，总量≤100MB |
| | 需求列表 | 查看所有保存的产品方向 | 支持时间排序、标签筛选 |
| | 基础搜索 | 关键词搜索需求库 | 响应 < 500ms（1000 条内） |
| | 数据导出 | 导出为 JSON | MVP 支持基础导出 |
| **用户界面** | Side Panel | 侧边栏展示分析结果 | 首次打开 < 500ms |
| | 设置页面 | LLM 配置、站点白名单 | 配置项持久化保存 |
| | 欢迎引导 | 新用户引导流程 | 3 分钟内完成配置 |

#### P1 - 增强功能

| 功能模块 | 功能点 | 描述 | 备注 |
|---------|-------|------|------|
| **需求管理** | 需求去重 | 用户主动触发，LLM 分析相似需求 | 见 4.5 去重机制 |
| | 需求分组 | 将相似需求合并为分组 | 用户确认后执行 |
| **云端同步** | 账户系统 | 邮箱注册/登录 | 见附录 D |
| | 跨设备同步 | 需求数据实时同步 | |
| **平台扩展** | Twitter/X 适配 | 受限支持公开内容 | 受平台限制 |
| | Hacker News 适配 | 评论树结构化提取 | |
| **高级功能** | 批量分析 | 一次分析多个「待分析」内容 | |
| | 自定义标签 | 用户自定义标签体系 | |
| | 快捷键 | 自定义快捷键触发 | |

#### P2 - 远期功能

| 功能点 | 描述 |
|-------|------|
| 需求社区 | 匿名分享/订阅他人发现的方向 |
| 竞品关联 | 自动关联相关竞品详情 |
| AI 副驾驶 | 直接生成 PRD/商业计划 |
| 团队协作 | 团队共享需求库 |

### 4.3 数据模型

**设计原则**：采用两层数据结构，以**产品方向（Demand）为最小管理单元**，保留提取上下文（Extraction）。

#### 4.3.1 数据关系

```
┌─────────────────────────────────────────────────────┐
│                    数据关系                          │
├─────────────────────────────────────────────────────┤
│   Extraction（提取记录）         Demand（产品方向）   │
│   ┌─────────────────┐          ┌─────────────────┐  │
│   │ 来源页面信息     │    ┌────▶│ 解决方案        │  │
│   │ 原文 + 摘要     │    │     │ 核心差异点      │  │
│   │ 分析状态        │────┤     │ 验证依据        │  │
│   └─────────────────┘    │     │ 用户标注        │  │
│                          │     └─────────────────┘  │
│                          │     ┌─────────────────┐  │
│                          └────▶│ ...更多方向     │  │
│                                └─────────────────┘  │
│                 1 : N 关系                          │
└─────────────────────────────────────────────────────┘
```

#### 4.3.2 Extraction 模型

```typescript
/**
 * 提取记录 - 记录一次页面分析的上下文
 * 存储位置: IndexedDB (Dexie.js)
 */
interface Extraction {
  id: string;                    // UUID
  url: string;                   // 来源页面 URL
  title: string;                 // 页面标题
  platform: string;              // 平台标识 (reddit/zhihu/generic)

  // 内容
  originalText: string;          // 原始文本（未脱敏，本地存储）
  summary: string;               // AI/Readability 生成的摘要

  // 状态
  analysisStatus: 'completed' | 'pending' | 'failed';
  demandCount: number;           // 识别出的产品方向数量
  savedDemandCount: number;      // 用户保存的方向数量

  // 截断标记
  truncated: boolean;
  truncatedFields?: string[];
  originalLength?: number;

  // 时间戳
  capturedAt: Date;
  createdAt: Date;
  updatedAt: Date;
}
```

#### 4.3.3 Demand 模型（核心变更）

```typescript
/**
 * 产品方向 - 核心实体，最小管理单元
 * 【重要变更】从「痛点评分」改为「解决方案 + 验证依据」结构
 */
interface Demand {
  id: string;                    // UUID
  extractionId: string;          // 关联的提取记录 ID

  // ===== 核心：解决方案 =====
  solution: {
    title: string;               // 产品名/一句话描述（如「本地 PDF 批量处理工具」）
    description: string;         // 详细描述（2-3 句话）
    targetUser: string;          // 目标用户（如「需要频繁处理 PDF 的办公人员」）
    keyDifferentiators: string[]; // 核心差异点（3-5 个）
  };

  // ===== 支撑：验证依据 =====
  validation: {
    painPoints: string[];        // 用户痛点（如「现有工具太贵」）
    competitors: string[];       // 竞品名称（如「Adobe Acrobat」）
    competitorGaps: string[];    // 竞品不足（如「订阅制，功能臃肿」）
    quotes: string[];            // 原文证据（用户原话）
  };

  // ===== 来源快照（冗余，便于列表展示）=====
  sourceUrl: string;
  sourceTitle: string;
  sourcePlatform: string;

  // ===== 用户管理字段 =====
  tags: string[];                // 用户标签
  starred: boolean;              // 是否收藏
  archived: boolean;             // 是否归档
  notes: string;                 // 用户笔记

  // ===== 需求分组（P1，用户确认去重后填充）=====
  groupId?: string;              // 同一需求的分组 ID
  groupName?: string;            // 分组名称（如「PDF 工具需求」）

  // 时间戳
  createdAt: Date;
  updatedAt: Date;
}
```

#### 4.3.4 与旧模型对比

| 旧模型 (PRD 1.5) | 新模型 (PRD 2.0) | 变更理由 |
|-----------------|-----------------|---------|
| `painLevel: number` (1-10) | `solution.keyDifferentiators[]` | LLM 无法准确评分，差异点更有价值 |
| `frequency: number` (1-10) | 移除 | 单次分析无法判断频率 |
| `payWillingness: number` (1-10) | `validation.competitorGaps[]` | 竞品不足更能说明付费机会 |
| `category: string` | `solution.targetUser` | 目标用户比抽象分类更有用 |
| `evidence: string[]` | `validation.quotes[]` | 语义一致，仅改名 |

#### 4.3.5 索引设计

```typescript
// Dexie.js 索引配置
db.version(1).stores({
  extractions: 'id, url, platform, capturedAt, analysisStatus',
  demands: 'id, extractionId, *tags, starred, archived, groupId, createdAt, [starred+createdAt]'
});
```

### 4.4 存储策略与容量管理

#### 4.4.1 存储配置

```typescript
const STORAGE_CONFIG = {
  // 单条限制
  SINGLE_RECORD_LIMIT: 500 * 1024,        // 单条 500KB

  // 总容量限制
  TOTAL_SOFT_LIMIT: 50 * 1024 * 1024,     // 软限制 50MB（警告）
  TOTAL_HARD_LIMIT: 100 * 1024 * 1024,    // 硬限制 100MB（阻止新增）

  // 阈值
  WARNING_THRESHOLD: 0.8,                  // 80% 时警告
};
```

#### 4.4.2 单条截断规则

| 场景 | 处理方式 | 用户提示 |
|-----|---------|---------|
| 单条 < 500KB | 完整存储 | 无 |
| 单条 > 500KB | 截断 `originalText` 至 20,000 字符 | 「内容过长，已截断保存」 |
| 截断后仍超限 | 继续截断 `summary` 至 500 字符 | 同上 |
| 评论页超长 | 按 8,000 字符分块，保留前 N 块 | 「评论过多，已截取部分」 |

#### 4.4.3 总容量管理

```
用户存储使用情况
    │
    ├─► < 80% (40MB)
    │     └─► 正常使用
    │
    ├─► 80% - 100% (40-50MB)
    │     └─► 显示警告 Banner：「存储空间即将用尽（XX%），建议导出或清理」
    │
    └─► > 100% (>50MB)
          └─► 软限制：允许继续，但强提示
          └─► > 100MB 硬限制：阻止新增，提示「存储已满，请清理后继续」
```

#### 4.4.4 清理策略

| 操作 | 说明 |
|-----|------|
| 单条删除 | 删除单个 Demand |
| 批量删除 | 删除选中的多个 Demand |
| 清理已归档 | 一键删除所有 `archived: true` 的记录 |
| 导出后清理 | 导出 JSON 后提示是否清理已导出数据 |
| 一键清空 | 删除所有数据（需二次确认） |

### 4.5 需求去重机制

**设计思路**：
- 不做：每次保存时自动检测（浪费资源、单条匹配不准确）
- 要做：用户主动点击，LLM 批量分析整个需求库

#### 4.5.1 去重分析结果模型

```typescript
interface DuplicateAnalysisResult {
  groups: Array<{
    suggestedName: string;     // LLM 建议的分组名（如「PDF 工具需求」）
    demandIds: string[];       // 属于这一组的需求 ID
    reason: string;            // 为什么认为是同一需求
  }>;
  uniqueDemands: string[];     // 没有重复的需求 ID
}
```

#### 4.5.2 交互流程

```
需求库页面
    │
    └─► 用户点击「🔍 分析重复需求」按钮
            │
            ├─► 发送需求库（仅 solution.title + solution.description）给 LLM
            │
            ├─► LLM 返回分组建议
            │
            └─► 展示分析结果
                  │
                  ├─► 「PDF 工具需求」(3 条)
                  │     • 本地 PDF 批量处理工具
                  │     • 简单的 PDF 合并工具
                  │     • 离线 PDF 编辑器
                  │     [✓ 合并为一组] [✗ 保持独立]
                  │
                  └─► 「笔记工具需求」(2 条)
                        • ...
                        [✓ 合并为一组] [✗ 保持独立]
```

#### 4.5.3 合并后展示

合并后，需求库列表显示分组卡片：

```
┌─────────────────────────────────────────┐
│ ⭐ PDF 工具需求                  [3 条] │
│                                         │
│ 本地运行 · 轻量级 · 批量操作            │
│                                         │
│ 来源：r/SaaS, 知乎, HackerNews          │
│ [展开查看 3 条相关需求]                  │
└─────────────────────────────────────────┘
```

### 4.6 LLM 配置方案

#### 4.6.1 配置模型

```typescript
interface LLMConfig {
  provider: 'openai' | 'google' | 'deepseek' | 'custom';
  apiKey: string;
  baseUrl?: string;        // 自定义 API 地址（可选）
  modelName?: string;      // 自定义模型名（可选）
}

// 预设配置
const PROVIDER_PRESETS = {
  openai: {
    baseUrl: 'https://api.openai.com/v1',
    defaultModel: 'gpt-4o-mini',
    keyPrefix: 'sk-',
    docUrl: 'https://platform.openai.com/api-keys',
  },
  google: {
    baseUrl: 'https://generativelanguage.googleapis.com/v1beta',
    defaultModel: 'gemini-1.5-flash',
    keyPrefix: 'AI',
    docUrl: 'https://aistudio.google.com/app/apikey',
  },
  deepseek: {
    baseUrl: 'https://api.deepseek.com/v1',
    defaultModel: 'deepseek-chat',
    keyPrefix: 'sk-',
    docUrl: 'https://platform.deepseek.com/api_keys',
  },
  custom: {
    baseUrl: '',
    defaultModel: '',
    keyPrefix: '',
    docUrl: '',
  },
};
```

#### 4.6.2 设置页面 UI

```
┌─────────────────────────────────────────┐
│ ⚙️ LLM 配置                             │
├─────────────────────────────────────────┤
│                                         │
│ 服务商                                   │
│ ┌─────────────────────────────────────┐ │
│ │ ○ OpenAI        (gpt-4o-mini)       │ │
│ │ ○ Google        (gemini-1.5-flash)  │ │
│ │ ● DeepSeek      (deepseek-chat)     │ │
│ │ ○ 自定义                             │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ API Key *                    [获取 Key] │
│ ┌─────────────────────────────────────┐ │
│ │ sk-xxxxxxxxxxxxxxxxxxxxxxxx        │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ ▼ 高级选项                              │
│ ┌─────────────────────────────────────┐ │
│ │ Base URL（使用代理时填写）           │ │
│ │ [                                 ] │ │
│ │                                     │ │
│ │ 模型名称                            │ │
│ │ [deepseek-chat                    ] │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ [测试连接]                    [保存配置] │
│                                         │
│ ✅ 连接成功！模型: deepseek-chat        │
└─────────────────────────────────────────┘
```

### 4.7 Side Panel UI 规范

#### 4.7.1 视图结构

```
Side Panel 包含 3 个主要视图：
┌─────────────────────────────────────────┐
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │
│  │ 分析视图 │  │ 需求库  │  │  设置   │ │
│  │ (默认)  │  │         │  │         │ │
│  └─────────────┘  └─────────────┘  └─────────────┘ │
└─────────────────────────────────────────┘
```

#### 4.7.2 视图 1：分析视图

```
┌─────────────────────────────────────────┐
│ Demand Radar           [需求库] [⚙️]    │
├─────────────────────────────────────────┤
│ 📄 当前页面                              │
│ ┌─────────────────────────────────────┐ │
│ │ r/SaaS - Why is there no good...   │ │
│ │ reddit.com · 可分析                 │ │
│ └─────────────────────────────────────┘ │
│                                         │
│       ┌─────────────────────┐          │
│       │   🔍 分析此页面     │          │
│       └─────────────────────┘          │
│       ┌─────────────────────┐          │
│       │   📥 快速保存       │          │
│       └─────────────────────┘          │
├─────────────────────────────────────────┤
│ 📊 分析结果                              │
│ ─────────────────────────────────────── │
│ 📋 摘要                                 │
│ ┌─────────────────────────────────────┐ │
│ │ 用户讨论现有 PDF 工具的痛点，主要   │ │
│ │ 集中在价格、功能臃肿、隐私担忧...   │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ 💡 识别到 2 个产品方向                   │
│ ─────────────────────────────────────── │
│ ┌─────────────────────────────────────┐ │
│ │ ☑️ 方向 1                   [展开 ▼] │ │
│ │ 本地 PDF 批量处理工具                │ │
│ │ ✨ 本地运行 · 一次买断 · 批量操作    │ │
│ │ 🏢 vs Adobe, Smallpdf               │ │
│ └─────────────────────────────────────┘ │
│ ┌─────────────────────────────────────┐ │
│ │ ☐ 方向 2                   [展开 ▼] │ │
│ │ 隐私优先的文档处理方案               │ │
│ │ ✨ 端到端加密 · 本地处理             │ │
│ │ 🏢 vs Google Docs, Notion           │ │
│ └─────────────────────────────────────┘ │
│                                         │
├─────────────────────────────────────────┤
│        [💾 保存选中的 1 个方向]         │
└─────────────────────────────────────────┘
```

#### 4.7.3 视图 2：方向详情（展开状态）

```
┌─────────────────────────────────────────┐
│ ← 返回                       ⭐ 📤 ⋮    │
├─────────────────────────────────────────┤
│                                         │
│ 💡 本地 PDF 批量处理工具                 │
│                                         │
│ ┌─────────────────────────────────────┐ │
│ │ 一款本地运行、一次买断的轻量工具，   │ │
│ │ 专注 PDF 批量合并、拆分、压缩，      │ │
│ │ 面向需要频繁处理 PDF 的办公人员      │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ ✨ 核心差异点                            │
│ • 本地运行，保护隐私                    │
│ • 一次买断，无订阅                      │
│ • 专注批量操作，不做复杂编辑            │
│                                         │
├─────────────────────────────────────────┤
│ 📊 为什么有机会                          │
├─────────────────────────────────────────┤
│                                         │
│ 😫 用户痛点                              │
│ • 现有工具太贵                          │
│ • 在线工具担心隐私                      │
│ • 功能太复杂，只需要简单操作            │
│                                         │
│ 🏢 竞品及其不足                          │
│ • Adobe Acrobat — 订阅制，功能臃肿      │
│ • Smallpdf — 免费版限制多，要上传云端   │
│ • iLovePDF — 在线工具，隐私顾虑         │
│                                         │
├─────────────────────────────────────────┤
│ 💬 原文证据 (3)                   [展开] │
│ ┌─────────────────────────────────────┐ │
│ │ "Every tool wants $20/mo just to    │ │
│ │  merge some PDFs"                   │ │
│ ├─────────────────────────────────────┤ │
│ │ "Don't want to upload sensitive     │ │
│ │  contracts to some random website"  │ │
│ └─────────────────────────────────────┘ │
│                                         │
├─────────────────────────────────────────┤
│ 🔗 来源                                 │
│ r/SaaS · "Why is there no good..."     │
│ 2小时前                  [打开原文 ↗]   │
├─────────────────────────────────────────┤
│ 🏷️ [SaaS创意] [已验证] [+ 添加]         │
├─────────────────────────────────────────┤
│ 📝 我的笔记                      [编辑] │
│ ┌─────────────────────────────────────┐ │
│ │ 可以用 pdf-lib + Electron 做        │ │
│ │ 竞品定价 $20-50，可以定 $29 一次买断 │ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
```

#### 4.7.4 视图 3：需求库列表

```
┌─────────────────────────────────────────┐
│ ← 返回分析       需求库 (24) [🔍去重] [⚙️] │
├─────────────────────────────────────────┤
│ 🔍 搜索产品方向...                       │
├─────────────────────────────────────────┤
│ 筛选: [全部▾] [标签▾] [⭐收藏] [📁归档] │
├─────────────────────────────────────────┤
│                                         │
│ ⭐ 本地 PDF 批量处理工具                 │
│    本地运行 · 一次买断 · 批量操作        │
│    🏢 vs Adobe, Smallpdf                │
│    r/SaaS · 2小时前                     │
│    [SaaS创意] [待验证]                   │
│ ─────────────────────────────────────── │
│    隐私优先的文档处理方案               │
│    端到端加密 · 本地处理                │
│    r/SaaS · 2小时前                     │
│ ─────────────────────────────────────── │
│ ⭐ 本土化项目管理工具                    │
│    符合国内习惯 · 轻量级                │
│    知乎 · 昨天                          │
│    [工具] [已验证]                       │
│ ─────────────────────────────────────── │
│    ... 更多                             │
│                                         │
├─────────────────────────────────────────┤
│ 共 24 个方向 · 5 个收藏                 │
│ 存储: 12.3 MB / 50 MB                   │
└─────────────────────────────────────────┘
```

#### 4.7.5 交互规范

| 交互 | 行为 | 说明 |
|-----|------|------|
| 点击扩展图标 | 打开/关闭 Side Panel | 切换显示状态 |
| 点击「分析此页面」 | 提取内容 + LLM 分析 | 显示骨架屏 → 流式输出结果 |
| 点击「快速保存」 | 仅保存原文 + 基础摘要 | 不调用 LLM，标记「待分析」 |
| 勾选方向 | 选中/取消选中 | 控制哪些方向被保存 |
| 点击「保存选中」 | 保存到 IndexedDB | 仅保存勾选的方向 |
| 点击方向卡片 | 展开详情 | 显示完整信息和操作 |
| 点击 ⭐ | 切换收藏状态 | 收藏的方向优先显示 |
| 点击「打开原文」 | 新标签页打开来源 | 验证上下文 |
| 搜索输入 | 实时筛选 | 防抖 300ms |
| 点击「分析重复」 | 触发去重分析 | P1 功能 |

---

## 五、隐私与数据合规

### 5.1 数据最小化原则

| 原则 | 实施方式 |
|-----|---------|
| **按需采集** | 仅在用户主动触发时提取页面内容，不后台自动采集 |
| **最小上下文** | 发送给 LLM 的内容经过裁剪，仅保留分析必需的文本 |
| **本地优先** | 所有数据默认存储在本地 IndexedDB，不强制上传 |
| **用户可控** | 用户可随时查看、导出、删除所有存储的数据 |

### 5.2 站点白名单/黑名单

```typescript
interface SiteFilterConfig {
  mode: 'whitelist' | 'blacklist' | 'all';  // MVP 默认 whitelist
  whitelist: string[];   // 仅在这些站点启用
  blacklist: string[];   // 在这些站点禁用
}
```

**默认策略 (MVP)**：
- 默认白名单模式
- 安装引导推荐勾选：知乎、Reddit
- 通用网页需用户手动授权当前域名后再注入

**内置黑名单**（用户可修改）：
- `*://*.bank.*/*`
- `*://mail.*/*`
- `*://*.gov.*/*`
- `*://*/login*`
- `*://*/account*`

### 5.3 敏感信息过滤

> **核心原则**：本地存储保留原文，PII 脱敏仅在发送给 LLM 之前执行。

#### 5.3.1 PII 过滤规则

| 类型 | 检测模式 | 处理方式 |
|-----|---------|---------|
| 邮箱 | `[\w.-]+@[\w.-]+\.\w+` | 替换为 `[EMAIL]` |
| 电话 | `1[3-9]\d{9}` / `\d{3}-\d{4}-\d{4}` | 替换为 `[PHONE]` |
| 身份证 | `\d{17}[\dXx]` | 替换为 `[ID]` |
| 信用卡 | `\d{4}[\s-]?\d{4}[\s-]?\d{4}[\s-]?\d{4}` | 替换为 `[CARD]` |
| IP 地址 | `\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}` | 替换为 `[IP]` |

#### 5.3.2 脱敏时机

| 阶段 | 是否脱敏 | 说明 |
|-----|---------|------|
| 内容提取 | 否 | 提取原始内容 |
| 本地存储 (IndexedDB) | 否 | 保留原文，便于用户查证 |
| 发送至 LLM | **是** | 执行 PII 过滤后再发送 |

### 5.4 用户数据权利

| 权利 | 实现方式 |
|-----|---------|
| **查看权** | 设置页 → 数据管理 → 查看所有存储数据 |
| **导出权** | 一键导出为 JSON，包含所有用户数据 |
| **删除权** | 单条删除 / 批量删除 / 一键清空 |
| **离线处理** | 无网络时默认本地处理，不尝试外传 |

### 5.5 LLM 调用错误处理

#### 5.5.1 错误分类与前端提示

| 错误类型 | HTTP 状态码 | 前端提示文案 | 处理方式 |
|---------|-----------|-------------|---------|
| **API Key 无效** | 401 | 「API Key 无效，请检查设置」 | 引导用户到设置页 |
| **API Key 未配置** | - | 「请先配置 API Key」 | 显示配置引导 |
| **额度耗尽** | 429 | 「API 调用额度已用尽，请检查账户」 | 存储原文，标记待分析 |
| **请求超时** | timeout | 「分析超时，已保存原文待后续处理」 | 存储原文，标记待分析 |
| **网络错误** | network error | 「网络连接失败，已切换离线模式」 | Readability 生成基础摘要 |
| **服务不可用** | 500/502/503 | 「AI 服务暂时不可用，请稍后重试」 | 存储原文，提供重试按钮 |
| **内容过长** | 400 (token limit) | 「内容超出分析限制，已截取部分内容」 | 截断后重试 |
| **其他错误** | - | 「分析失败：[错误信息]」 | 存储原文，显示详细错误 |

#### 5.5.2 错误处理流程

```
LLM 调用失败
    │
    ├─► 网络错误 → 重试 1 次 → 仍失败 → 离线模式 (Readability 摘要)
    │
    ├─► 401 认证失败 → 提示检查 API Key → 引导到设置页
    │
    ├─► 429 额度耗尽 → 提示检查账户额度 → 存储原文
    │
    ├─► 超时 (>15s) → 后台继续 (60s) → 仍超时 → 存储原文，标记待分析
    │
    └─► 其他错误 → 存储原文，显示错误信息 + 重试按钮
```

#### 5.5.3 UI 错误状态示例

```
┌─────────────────────────────────────────┐
│ ⚠️ 分析失败                             │
│ API Key 无效，请检查设置                 │
│ ─────────────────────────────────────── │
│ ┌─────────────────────────────────────┐ │
│ │ 已保存原文，配置后可重新分析         │ │
│ └─────────────────────────────────────┘ │
│ [前往设置] [查看原文]                    │
└─────────────────────────────────────────┘
```

---

## 六、非功能需求

### 6.1 分场景性能指标

#### 6.1.1 场景分类与时间阈值

| 场景 | 内容规模 | 提取时间 | LLM分析时间 | 总时间阈值 | 降级策略 |
|-----|---------|---------|-----------|-----------|---------|
| **单页文章** | < 3000 字 | < 1s | < 5s | **< 6s** | - |
| **长帖子** | 3000-10000 字 | < 2s | < 8s | **< 10s** | >8s 显示「后台继续分析」 |
| **多评论页** | > 50 条评论 | < 3s | < 10s | **< 13s** | >8s 显示进度条 |
| **超长内容** | > 10000 字 | < 3s | - | - | 提示「已截取前 8000 字」 |

#### 6.1.2 降级与失败处理

| 情况 | 处理方式 | 用户提示 |
|-----|---------|---------|
| 提取超时 (>5s) | 返回已提取内容 | 「部分内容提取完成」 |
| LLM 超时 (>15s) | 存储原文，标记待分析 | 「内容已保存，后台继续分析」 |
| LLM 失败 | 仅存储原文和基础摘要 | 「AI 分析暂不可用，已保存原文」 |
| 网络离线 | 本地 Readability 摘要 | 「离线模式：已生成基础摘要」 |
| 存储超限 (>500KB) | 截断 originalText/summary | 「内容过长，已截断保存」 |

#### 6.1.3 内存与资源占用

| 指标 | 目标值 | 说明 |
|-----|-------|------|
| 常驻内存 | **< 80MB** | Background Service Worker 常驻 |
| 峰值内存 | **< 150MB** | 分析大页面时的峰值 |
| CPU 占用 | < 5% (空闲) | 无操作时 |

**UI 组件加载策略**：
- Side Panel 作为主界面，提供完整功能
- 需求列表采用虚拟滚动，单次渲染 ≤ 20 条
- 图片/富文本预览延迟加载

### 6.2 兼容性要求

| 平台 | 要求 | 备注 |
|-----|------|------|
| Chrome | v100+ | MVP 主要平台 |
| Edge | v100+ | 兼容测试 |
| Firefox | v100+ | P1 适配 |
| Safari | 暂不支持 | MV3 兼容性问题 |

### 6.3 安全要求

#### 6.3.1 权限最小化

```json
// manifest.json 权限声明
{
  "permissions": [
    "activeTab",      // 仅当前激活标签页
    "storage",        // 本地存储
    "scripting",      // 动态注入内容脚本
    "sidePanel"       // Side Panel 支持
  ],
  "host_permissions": [
    "https://*.reddit.com/*",
    "https://*.zhihu.com/*"
  ],
  "optional_host_permissions": [
    "https://*/*",
    "http://*/*"
  ]
}
```

**不申请的权限**：
- `tabs` - 不需要访问所有标签页
- `history` - 不需要浏览历史
- `bookmarks` - 不需要书签
- `webRequest` - 不需要拦截请求

#### 6.3.2 内容脚本安全

| 措施 | 说明 |
|-----|------|
| **脚本隔离** | Content Script 运行在隔离环境 |
| **XSS 防护** | 使用 DOMPurify 清理提取的 HTML |
| **CSP 遵守** | 不使用 `eval()`、内联脚本 |
| **消息验证** | Runtime 消息通信验证 sender.id |

#### 6.3.3 内容脚本注入策略

| 策略 | 适用场景 | 实现方式 |
|-----|---------|---------|
| 声明式注入 | 知乎、Reddit | manifest.json content_scripts |
| 动态注入 | 通用网页（需授权） | `chrome.scripting.executeScript` |

---

## 七、验收标准与指标

### 7.1 MVP 范围定义

**包含**：
- [x] 一键提取当前页面内容（知乎 + Reddit + 通用网页）
- [x] 通用提取需用户授权站点（默认白名单模式）
- [x] LLM 解决方案提炼（用户自备 API Key，支持多服务商）
- [x] 产品方向输出（solution + validation 结构）
- [x] 本地存储需求列表（IndexedDB），单条≤500KB，总量≤100MB
- [x] 基础搜索和标签筛选
- [x] Side Panel 界面
- [x] 站点白名单/黑名单
- [x] PII 脱敏过滤（仅 LLM 发送前）
- [x] 离线降级（快速保存模式）
- [x] 数据导出（JSON）

**不包含**：
- [ ] 云端同步服务器 → P1
- [ ] 账户系统 → P1
- [ ] 跨设备数据同步 → P1
- [ ] 需求去重分析 → P1
- [ ] 批量分析 → P1
- [ ] Twitter/X 适配 → P1
- [ ] 社区功能 → P2

### 7.2 解决方案提炼质量评估

> **核心变更**：从「Top3 需求命中率」改为「解决方案提炼质量」的人工评估

#### 7.2.1 评估维度

| 维度 | 评估问题 | 权重 |
|-----|---------|------|
| **方向合理性** | 提炼的产品方向是否合理？能否解决用户痛点？ | 30% |
| **差异点准确** | 核心差异点是否抓住了竞品的真正不足？ | 25% |
| **证据支撑** | 痛点和竞品不足是否有原文证据支撑？ | 20% |
| **可操作性** | 看完是否知道可以做什么产品？ | 25% |

#### 7.2.2 评估方法

1. **样本准备**：50 条测试样本（来自 Reddit 25 条 + 知乎 25 条的真实吐槽帖）
2. **LLM 输出**：对每条样本执行解决方案提炼
3. **双盲评审**：2 位评审员独立打分（1-5 分）
4. **一致性检验**：评审员间 Kappa 系数 ≥ 0.6

#### 7.2.3 验收标准

| 指标 | 目标值 | 说明 |
|-----|-------|------|
| 综合平均分 | **≥ 3.5 / 5** | 所有维度加权平均 |
| 可操作性评分 | **≥ 3.5 / 5** | 核心指标，单独考核 |
| 证据缺失率 | **≤ 15%** | `validation.quotes` 为空的比例 |

### 7.3 核心指标与埋点

#### 7.3.1 北极星指标

| 指标 | 目标值 | 定义 |
|-----|-------|------|
| **周活跃留存** | ≥ 35% | 第 N 周活跃用户在 N+1 周仍活跃 |
| **首次分析→保存转化** | ≥ 40% | 完成首次分析的用户中，保存至少 1 个方向 |

#### 7.3.2 核心指标

| 指标 | 目标值 | 衡量方式 |
|-----|-------|---------|
| 安装量 | 500+ | Chrome 商店数据 |
| 周活跃用户 (WAU) | 100+ | 插件埋点 |
| 单用户周均使用次数 | 5+ | 插件埋点 |
| 用户满意度 | 4.0+ 星 | Chrome 商店评分 |
| API Key 配置完成率 | ≥ 70% | 安装后 7 天内完成配置 |

#### 7.3.3 埋点事件表

| 事件名 | 触发时机 | 关键参数 | 用途 |
|-------|---------|---------|------|
| `install` | 插件安装完成 | install_source, browser_version | 获客渠道 |
| `config_llm` | 配置 LLM | provider | 配置完成率 |
| `first_analyze` | 首次分析 | platform, content_length | 激活转化 |
| `analyze` | 每次分析 | platform, duration_ms, demand_count | 功能使用 |
| `analyze_fail` | 分析失败 | error_type, fallback_action | 错误监控 |
| `quick_save` | 快速保存 | platform | 降级使用 |
| `save_demand` | 保存方向 | demand_count, has_tags | 核心转化 |
| `search` | 搜索需求库 | query_length, result_count | 功能使用 |
| `export` | 导出数据 | format, record_count | 功能使用 |
| `storage_warning` | 存储警告触发 | usage_percent | 容量监控 |

**隐私说明**：
- 所有埋点数据匿名化，不包含用户身份信息
- 不上报页面 URL、提取内容、分析结果
- 用户可在设置中关闭数据收集

### 7.4 负向指标（质量控制）

| 指标 | 定义 | 目标 | 计算方式 |
|-----|------|------|---------|
| **空洞方案率** | 输出的方案过于泛泛，无具体方向 | ≤ 20% | 人工判定「是否空洞」 |
| **证据缺失率** | 痛点/竞品不足没有原文支撑 | ≤ 15% | `validation.quotes` 为空的比例 |
| **用户删除率** | 用户保存后又删除的比例 | ≤ 15% | 删除数 / 保存数 |
| **分析失败率** | LLM 分析失败的比例 | ≤ 10% | 失败数 / 总分析数 |

---

## 八、迭代路线图

### 8.1 Week 0 - 技术验证（3-5 天）

> **核心目标**：验证技术可行性，识别风险点

```
Week 0: 技术验证
├── 知乎内容提取 POC
│     ├── 是否需要登录？
│     ├── 反爬措施情况？
│     └── 动态加载处理方案
│
├── Reddit 内容提取 POC
│     ├── DOM 结构稳定性
│     ├── 评论树提取方案
│     └── 不同 subreddit 兼容性
│
├── LLM Prompt 原型
│     ├── 手动测试 10 个样本
│     ├── 输出结构验证
│     └── 服务商 API 兼容性
│
├── Side Panel API Demo
│     ├── 基础框架搭建
│     └── 与 Content Script 通信
│
└── 输出物
      ├── 技术可行性报告
      ├── 风险清单
      └── 平台适配预案
```

**知乎反爬应对预案**：

| 情况 | 应对方案 |
|-----|---------|
| 需要登录才能看内容 | 提示用户先登录，只提取可见内容 |
| 动态加载 | 只提取首屏已加载内容，提示用户手动展开 |
| 完全封禁 | 降级为通用提取器，知乎移至 P1 |

### 8.2 Phase 1 - MVP（5 周 + 1 周缓冲）

```
Week 1: 提取稳定性
├── 目标: 知乎 + Reddit 提取器稳定可用
├── 里程碑: 各 30 条页面测试通过率 ≥ 90%
├── 任务:
│     ├── 知乎适配器开发
│     ├── Reddit 适配器开发
│     ├── 通用 Readability 提取
│     └── 平台检测与路由
└── 产出: Content Script + 平台适配器

Week 2: Side Panel 骨架
├── 目标: Side Panel 基本可用
├── 里程碑: 侧边栏展示提取结果，支持基础交互
├── 任务:
│     ├── Side Panel 框架搭建
│     ├── 分析视图 UI
│     ├── 设置页面（LLM 配置）
│     └── 欢迎引导流程
└── 产出: Side Panel 组件 + 设置页面

Week 3: LLM 接入 + 存储
├── 目标: LLM 分析流程完整
├── 里程碑: 解决方案提炼质量评分 ≥ 3.5（20 条样本）
├── 任务:
│     ├── 多服务商 LLM 接入
│     ├── Prompt 工程优化
│     ├── IndexedDB 存储实现
│     ├── 离线降级（快速保存）
│     └── 容量管理
└── 产出: LLM 服务 + 存储模块

Week 4: 安全 + 打磨
├── 目标: 安全机制完备，体验打磨
├── 里程碑: PII 过滤、白名单、错误处理完成
├── 任务:
│     ├── PII 过滤实现
│     ├── 站点白名单/黑名单
│     ├── 错误处理优化
│     ├── 埋点接入
│     └── UI 细节打磨
└── 产出: 安全模块 + 埋点

Week 5: 测试 + 上架准备
├── 目标: 提交 Chrome 商店审核
├── 里程碑: 通过内部测试，准备商店素材
├── 任务:
│     ├── 集成测试
│     ├── 性能测试
│     ├── 商店素材准备
│     └── 隐私政策文档
└── 产出: 测试报告 + 商店页面

Week 6: 缓冲周
├── 用途: 应对平台变更、审核反馈、紧急 Bug
└── 如无问题: 用于 P1 功能预研
```

### 8.3 Phase 2 - 增强（4-6 周）

```
Phase 2: 增强功能
├── 需求去重分析
│     ├── 用户主动触发
│     ├── LLM 批量分析
│     └── 分组管理
│
├── 云端同步
│     ├── 账户系统（邮箱注册）
│     ├── Supabase/Firebase 集成
│     └── 跨设备同步
│
├── 平台扩展
│     ├── Twitter/X 适配（受限）
│     ├── Hacker News 适配
│     └── 更多 subreddit 优化
│
└── 高级功能
      ├── 批量分析「待分析」内容
      ├── 自定义标签体系
      └── 快捷键支持
```

### 8.4 Phase 3 - 扩展（持续）

```
Phase 3: 扩展功能
├── 需求社区
├── 团队协作
├── AI 副驾驶（PRD 生成）
└── 竞品关联
```

### 8.5 风险与应对

| 风险 | 影响 | 概率 | 应对措施 |
|-----|-----|-----|---------|
| LLM API 成本过高 | 用户流失 | 中 | 多服务商支持、快速保存模式、用量提示 |
| 页面结构变化 | 功能不可用 | 高 | 平台适配器架构 + 回退策略 + 缓冲周 |
| 用户隐私担忧 | 口碑下降 | 中 | 本地优先、PII 过滤、透明隐私政策 |
| API Key 泄露 | 用户财产损失 | 低 | 使用指引、提醒定期轮换 |
| Chrome 商店审核被拒 | 上线延期 | 中 | 预留缓冲周、研究审核政策 |
| 知乎反爬升级 | 平台不可用 | 中 | Week 0 验证、降级为通用提取 |
| IndexedDB 容量问题 | 数据丢失 | 低 | 容量管理、导出提醒 |

---

## 九、附录

### A. Prompt 设计规范

#### A.1 解决方案提炼 Prompt

```
你是一个产品机会分析专家。请从以下用户讨论内容中提炼可能的产品方向。

【输入内容】
{content}

【输出要求】
请以 JSON 格式输出，包含以下字段：

{
  "demands": [
    {
      "solution": {
        "title": "产品名称（一句话）",
        "description": "详细描述（2-3句话，说明是什么产品）",
        "targetUser": "目标用户（谁会用这个产品）",
        "keyDifferentiators": ["差异点1", "差异点2", "差异点3"]
      },
      "validation": {
        "painPoints": ["用户痛点1", "用户痛点2"],
        "competitors": ["竞品名称1", "竞品名称2"],
        "competitorGaps": ["竞品不足1", "竞品不足2"],
        "quotes": ["原文证据1", "原文证据2"]
      }
    }
  ],
  "summary": "页面内容摘要（100-200字）"
}

【注意事项】
1. 每个方向的 keyDifferentiators 应该是具体的、可执行的差异点
2. quotes 必须是原文中的实际内容，不要编造
3. 如果内容中没有明显的产品机会，返回空数组
4. 最多输出 3 个产品方向，优先输出最有价值的
```

#### A.2 需求去重 Prompt

```
你是一个产品需求分析专家。请分析以下产品方向列表，找出指向同一产品机会的相似方向。

【输入】
{demands_list}

【输出要求】
{
  "groups": [
    {
      "suggestedName": "分组名称",
      "demandIds": ["id1", "id2"],
      "reason": "为什么认为这些是同一方向"
    }
  ],
  "uniqueDemands": ["id3", "id4"]
}

【判断标准】
- 解决同一个核心问题
- 目标用户群体相同
- 核心差异点高度重叠
```

### B. 验收测试集规范

#### B.1 正文识别测试集

| 平台 | 样本数 | 样本类型 | 标注内容 |
|-----|-------|---------|---------|
| Reddit | 30+ | 帖子正文 | 预期提取的正文边界 |
| 知乎 | 30+ | 问答内容 | 预期提取的问题+回答 |
| 通用 | 20+ | 博客/新闻 | 预期提取的文章正文 |

#### B.2 准确率/召回率计算

```
准确率 = 正确提取的字符数 / 实际提取的总字符数
召回率 = 正确提取的字符数 / 应该提取的总字符数

判定标准:
- 正确: 提取内容与人工标注重叠度 ≥ 80%
- 遗漏: 应提取内容未被提取
- 噪音: 不应提取的内容被提取 (广告、导航等)
```

#### B.3 解决方案提炼测试

| 指标 | 计算方式 | 目标 |
|-----|---------|------|
| 综合平均分 | 4 维度加权平均 | ≥ 3.5/5 |
| 可操作性评分 | 单独维度评分 | ≥ 3.5/5 |
| 评审员一致性 | Cohen's Kappa | ≥ 0.6 |
| 样本量 | - | 50 条 |

#### B.4 存储截断测试

| 测试场景 | 预期行为 | 验收标准 |
|---------|---------|---------|
| 正常内容 (<500KB) | 完整存储 | truncated: false |
| 超长内容 (>500KB) | 截断后存储 | truncated: true, 用户收到提示 |
| 总容量 >80% | 显示警告 | Banner 出现 |
| 总容量 >100MB | 阻止新增 | 错误提示出现 |

### C. Chrome 扩展数据声明

#### C.1 权限声明 (manifest.json)

```json
{
  "manifest_version": 3,
  "name": "Demand Radar",
  "version": "1.0.0",
  "permissions": [
    "activeTab",
    "storage",
    "scripting",
    "sidePanel"
  ],
  "host_permissions": [
    "https://*.reddit.com/*",
    "https://*.zhihu.com/*"
  ],
  "optional_host_permissions": [
    "https://*/*",
    "http://*/*"
  ],
  "content_scripts": [
    {
      "matches": ["*://*.reddit.com/*", "*://*.zhihu.com/*"],
      "js": ["content-platform.js"],
      "run_at": "document_idle"
    }
  ],
  "side_panel": {
    "default_path": "sidepanel.html"
  }
}
```

#### C.2 Chrome Web Store 数据披露

| 披露项 | 声明内容 |
|-------|---------|
| **数据收集** | 收集用户主动提取的网页内容用于分析 |
| **数据使用** | 本地存储 + 发送至用户配置的 LLM API |
| **数据共享** | 不与第三方共享（LLM API 除外，用户自行配置） |
| **数据存储** | 存储在本地 IndexedDB |
| **数据删除** | 用户可随时删除所有数据 |

#### C.3 隐私政策要点

1. 我们仅在用户主动触发时提取页面内容
2. 提取的内容经过 PII 脱敏后发送至用户配置的 LLM 服务（本地存储保留原文）
3. 所有数据默认存储在用户本地设备
4. 我们不运营任何服务器存储用户数据（MVP 阶段）
5. 用户可随时导出或删除所有数据

### D. P1 同步方案

> 本节内容在 Phase 2 实现，MVP 阶段不适用

#### D.1 同步架构

```
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│   设备 A     │     │   云端服务    │     │   设备 B     │
│  (Chrome)    │────▶│  (Supabase)  │◀────│  (Edge)      │
└──────────────┘     └──────────────┘     └──────────────┘
       │                    │                    │
       ▼                    ▼                    ▼
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│ IndexedDB    │     │  PostgreSQL  │     │ IndexedDB    │
│ (本地缓存)   │     │  (主数据库)   │     │ (本地缓存)   │
└──────────────┘     └──────────────┘     └──────────────┘
```

#### D.2 同步策略

| 策略 | 描述 | 适用场景 |
|-----|------|---------|
| **本地优先** | 所有操作先写入本地，后台异步同步 | 保证离线可用 |
| **增量同步** | 只同步变更数据，非全量覆盖 | 节省带宽 |
| **冲突解决** | 以最后修改时间为准 | 多设备编辑 |
| **实时推送** | WebSocket 推送变更 | 在线状态 |

### E. 技术选型

```
框架: Plasmo
UI: React + Tailwind CSS
状态管理: Zustand
本地存储: IndexedDB (Dexie.js)
内容提取: @mozilla/readability + Turndown
HTML清理: DOMPurify
LLM: OpenAI / Google / DeepSeek / 自定义（用户自备 Key）
埋点: 自建简易方案
同步 (P1): Supabase
```

### F. 竞品分析

| 竞品 | 定位 | 差异点 |
|-----|-----|-------|
| Glasp | 网页高亮笔记 | 我们聚焦产品方向提炼，非通用笔记 |
| Notion Web Clipper | 内容收藏 | 我们提供智能分析，非简单存储 |
| ChatGPT 插件 | 通用 AI 助手 | 我们专注需求场景，体验更垂直 |

---

## 变更记录

| 版本 | 日期 | 变更内容 | 作者 |
|-----|-----|---------|-----|
| 1.0 | 2025-12-08 | 初稿创建 | - |
| 1.5 | 2025-12-09 | 多次迭代修订（详见 prd1.5.md） | - |
| **2.0** | **2025-12-09** | **重大重构**，主要变更如下： | - |
| | | **产品定位**：从「需求信号收集器」转向「解决方案提炼器」 | |
| | | **数据模型**：从 painLevel/frequency/payWillingness 评分改为 solution + validation 结构 | |
| | | **平台策略**：Reddit 提升为 MVP P0，与知乎同时开发 | |
| | | **LLM 配置**：支持多服务商（OpenAI/Google/DeepSeek/自定义） | |
| | | **新增功能**：快速保存模式（零 API 成本）、需求去重机制（P1） | |
| | | **容量管理**：新增总容量限制（50MB 软限制/100MB 硬限制） | |
| | | **路线图**：新增 Week 0 技术验证阶段 | |
| | | **验收标准**：从「Top3 命中率」改为「解决方案提炼质量」人工评估 | |
| | | **新增附录**：Prompt 设计规范 | |

---

**文档结束**
